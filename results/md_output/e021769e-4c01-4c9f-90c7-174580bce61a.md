Ruby Units
Kevin C. Olbrich, Ph.D.
Project page: http://github.com/olbrich/ruby‑units
Introduction
Manytechnicalapplicationsmakeuseofspecializedcalculationsatsomepoint. Frequently,thesecal‑
culationsrequireunitconversionstoensureaccurateresults. Needlesstosay,thisisapaintoproperly
keep track of, and is prone to numerous errors.
Solution
The‘Rubyunits’gemisdesignedtosimplifythehandlingofunitsforscientificcalculations. Theunits
of each quantity are specified when a Unit object is created and the Unit class will handle all subse‑
quent conversions and manipulations to ensure an accurate result.
Installation
This package may be installed using:
1 gem install ruby-units
or add this to your Gemfile
1 gem 'ruby-units'
1

Usage
1 unit = Unit.new("1") # constant only
2 unit = Unit.new("mm") # unit only (defaults to a scalar
of 1)
3 unit = Unit.new("1 mm") # create a simple unit
4 unit = Unit.new("1 mm/s") # a compound unit
5 unit = Unit.new("1 mm s^-1") # in exponent notation
6 unit = Unit.new("1 kg*m^2/s^2") # complex unit
7 unit = Unit.new("1 kg m^2 s^-2") # complex unit
8 unit = Unit.new("1 mm") # shorthand
9 unit = "1 mm".to_unit # convert string object
10 unit = object.to_unit # convert any object using object.
to_s
11 unit = Unit.new('1/4 cup') # Rational number
12 unit = Unit.new('1+1i mm') # Complex Number
Rules
1. only 1 quantity per unit (with 2 exceptions… 6’5” and ‘8 lbs 8 oz’)
2. use SI notation when possible
3. spaces in units are allowed, but ones like ‘11/m’ will be recognized as ‘11 1/m’.
Unit compatibility
Manymethodsrequirethattheunitsoftwooperandsarecompatible. Compatibleunitsarethosethat
can be easily converted into each other, such as ‘meters’ and ‘feet’.
1 unit1 =~ unit2 #=> true if units are compatible
2 unit1.compatible?(unit2) #=> true if units are compatible
Unit Math
1 Unit#+() # Add. only works if units are compatible
2 Unit#-() # Subtract. only works if units are compatible
3 Unit#*() # Multiply.
4 Unit#/() # Divide.
5 Unit#**() # Exponentiate. Exponent must be an integer, can be
positive, negative, or zero
6 Unit#inverse # Returns 1/unit
7 Unit#abs # Returns absolute value of the unit quantity. Strips
off the units
8 Unit#ceil # rounds quantity to next highest integer
2

| 1 unit = Unit.new("1") # constant only                      |
|:------------------------------------------------------------|
| 2 unit = Unit.new("mm") # unit only (defaults to a scalar   |
| of 1)                                                       |
| 3 unit = Unit.new("1 mm") # create a simple unit            |
| 4 unit = Unit.new("1 mm/s") # a compound unit               |
| 5 unit = Unit.new("1 mm s^-1") # in exponent notation       |
| 6 unit = Unit.new("1 kg*m^2/s^2") # complex unit            |
| 7 unit = Unit.new("1 kg m^2 s^-2") # complex unit           |
| 8 unit = Unit.new("1 mm") # shorthand                       |
| 9 unit = "1 mm".to_unit # convert string object             |
| 10 unit = object.to_unit # convert any object using object. |
| to_s                                                        |
| 11 unit = Unit.new('1/4 cup') # Rational number             |
| 12 unit = Unit.new('1+1i mm') # Complex Number              |

| 1 unit1 =~ unit2 #=> true if units are compatible           |
|:------------------------------------------------------------|
| 2 unit1.compatible?(unit2) #=> true if units are compatible |

| 1 Unit#+() # Add. only works if units are compatible             |
|:-----------------------------------------------------------------|
| 2 Unit#-() # Subtract. only works if units are compatible        |
| 3 Unit#*() # Multiply.                                           |
| 4 Unit#/() # Divide.                                             |
| 5 Unit#**() # Exponentiate. Exponent must be an integer, can be  |
| positive, negative, or zero                                      |
| 6 Unit#inverse # Returns 1/unit                                  |
| 7 Unit#abs # Returns absolute value of the unit quantity. Strips |
| off the units                                                    |
| 8 Unit#ceil # rounds quantity to next highest integer            |

9 Unit#floor # rounds quantity down to next lower integer
10 Unit#round # rounds quantity to nearest integer
11 Unit#to_int # returns the quantity as an integer
Unit will coerce other objects into a Unit if used in a formula. This means…
1 Unit.new("1 mm") + "2 mm" == Unit.new("3 mm")
This will work as expected so long as you start the formula with a Unit object.
Conversions & Comparisons
Units can be converted to other units in a couple of ways.
1 unit.convert_to('ft') # convert
2 unit1 = unit >> "ft" # convert to 'feet'
3 unit >>= "ft" # convert and overwrite original
object
4 unit3 = unit1 + unit2 # resulting object will have the
units of unit1
5 unit3 = unit1 - unit2 # resulting object will have the
units of unit1
6 unit1 <=> unit2 # does comparison on quantities in
base units, throws an exception if not compatible
7 unit1 === unit2 # true if units and quantity are the
same, even if 'equivalent' by <=>
8 unit1 + unit2 >> "ft" # converts result of math to 'ft'
9 (unit1 + unit2).convert_to('ft') # converts result to 'ft'
Any object that defines a to_unit method will be automatically coerced to a unit during calcula‑
tions.
Text Output
Unitswilldisplaythemselvesnicelybasedonthedisplay_namefortheunitsandprefixes. SinceUnit
implements a Unit#to_s, all that is needed in most cases is:
1 "#{Unit.new('1 mm')}" #=> "1 mm"
The to_s also accepts some options.
1 Unit.new('1.5 mm').to_s("%0.2f") # "1.50 mm". Enter any valid format
2 # string. Also accepts strftime
format
3 Unit.new('10 mm').to_s("%0.2f in")# "0.39 in". can also format and
convert in
3

| 9 Unit#floor # rounds quantity down to next lower integer   |
|:------------------------------------------------------------|
| 10 Unit#round # rounds quantity to nearest integer          |
| 11 Unit#to_int # returns the quantity as an integer         |

| 1 unit.convert_to('ft') # convert                            |
|:-------------------------------------------------------------|
| 2 unit1 = unit >> "ft" # convert to 'feet'                   |
| 3 unit >>= "ft" # convert and overwrite original             |
| object                                                       |
| 4 unit3 = unit1 + unit2 # resulting object will have the     |
| units of unit1                                               |
| 5 unit3 = unit1 - unit2 # resulting object will have the     |
| units of unit1                                               |
| 6 unit1 <=> unit2 # does comparison on quantities in         |
| base units, throws an exception if not compatible            |
| 7 unit1 === unit2 # true if units and quantity are the       |
| same, even if 'equivalent' by <=>                            |
| 8 unit1 + unit2 >> "ft" # converts result of math to 'ft'    |
| 9 (unit1 + unit2).convert_to('ft') # converts result to 'ft' |

| 1 Unit.new('1.5 mm').to_s("%0.2f") # "1.50 mm". Enter any valid format   |
|:-------------------------------------------------------------------------|
| 2 # string. Also accepts strftime                                        |
| format                                                                   |
| 3 Unit.new('10 mm').to_s("%0.2f in")# "0.39 in". can also format and     |
| convert in                                                               |

4 # the same time.
5 Unit.new('1.5 mm').to_s("in") # converts to inches before printing
6 Unit.new("2 m").to_s(:ft) # returns 6'7"
7 Unit.new("100 kg").to_s(:lbs) # returns 220 lbs, 7 oz
8 Unit.new("100 kg").to_s(:stone) # returns 15 stone, 10 lb
Time Helpers
Time, Date, and DateTime objects can have time units added or subtracted.
1 Time.now + Unit.new("10 min")
Several helpers have also been defined. Note: If you include the ‘Chronic’ gem, you can specify times
in natural language.
1 Unit.new('min').since(DateTime.parse('9/18/06 3:00pm'))
Durations may be entered as ‘HH:MM:SS, usec’ and will be returned in ‘hours’.
1 Unit.new('1:00') #=> 1 h
2 Unit.new('0:30') #=> 0.5 h
3 Unit.new('0:30:30') #=> 0.5 h + 30 sec
If only one “:” is present, it is interpreted as the separator between hours and minutes.
Ranges
1 [Unit.new('0 h')..Unit.new('10 h')].each {|x| p x}
works so long as the starting point has an integer scalar
Math functions
All Trig math functions (sin, cos, sinh, hypot…) can take a unit as their parameter. It will be converted
to radians and then used if possible.
Temperatures
Ruby‑units makes a distinction between a temperature (which technically is a property) and degrees
of temperature (which temperatures are measured in).
4

| 4 # the same time.                                                   |
|:---------------------------------------------------------------------|
| 5 Unit.new('1.5 mm').to_s("in") # converts to inches before printing |
| 6 Unit.new("2 m").to_s(:ft) # returns 6'7"                           |
| 7 Unit.new("100 kg").to_s(:lbs) # returns 220 lbs, 7 oz              |
| 8 Unit.new("100 kg").to_s(:stone) # returns 15 stone, 10 lb          |

| 1 Unit.new('1:00') #=> 1 h               |
|:-----------------------------------------|
| 2 Unit.new('0:30') #=> 0.5 h             |
| 3 Unit.new('0:30:30') #=> 0.5 h + 30 sec |

Temperature units (i.e., ‘tempK’) can be converted back and forth, and will take into account the dif‑
ferences in the zero points of the various scales. Differential temperature (e.g., Unit.new(‘100 degC’))
units behave like most other units.
1 Unit.new('37 tempC').convert_to('tempF') #=> 98.6 tempF
Ruby‑units will raise an exception if you attempt to create a temperature unit that would fall below
absolute zero.
Unit math on temperatures is fairly limited.
1 Unit.new('100 tempC') + Unit.new('10 degC') # '110 tempC'.to_unit
2 Unit.new('100 tempC') - Unit.new('10 degC') # '90 tempC'.to_unit
3 Unit.new('100 tempC') + Unit.new('50 tempC') # exception (can't add
two temperatures)
4 Unit.new('100 tempC') - Unit.new('50 tempC') # '50 degC'.to_unit (get
the difference between two temperatures)
5 Unit.new('50 tempC') - Unit.new('100 tempC') # '-50 degC'.to_unit
6 Unit.new('100 tempC') * scalar # '100*scalar tempC'.
to_unit
7 Unit.new('100 tempC') / scalar # '100/scalar tempC'.
to_unit
8 Unit.new('100 tempC') * unit # exception
9 Unit.new('100 tempC') / unit # exception
10 Unit.new('100 tempC') ** N # exception
11
12 Unit.new('100 tempC').convert_to('degC') #=> Unit.new('100 degC')
This conversion references the 0 point on the scale of the temperature unit
1 Unit.new('100 degC').convert_to('tempC') #=> '-173 tempC'.to_unit
Theseconversionsarealwaysinterpretedasbeingrelativetoabsolutezero. Conversionsareprobably
better done like this…
1 Unit.new('0 tempC') + Unit.new('100 degC') #=> Unit.new('100 tempC')
Defining Units
It is possible to define new units or redefine existing ones.
Define New Unit The easiest approach is to define a unit in terms of other units.
1 Unit.define("foobar") do |foobar|
2 foobar.definition = Unit.new("1 foo") * Unit.new("1 bar") #
anything that results in a Unit object
5

| 1 Unit.new('100 tempC') + Unit.new('10 degC') # '110 tempC'.to_unit     |
|:------------------------------------------------------------------------|
| 2 Unit.new('100 tempC') - Unit.new('10 degC') # '90 tempC'.to_unit      |
| 3 Unit.new('100 tempC') + Unit.new('50 tempC') # exception (can't add   |
| two temperatures)                                                       |
| 4 Unit.new('100 tempC') - Unit.new('50 tempC') # '50 degC'.to_unit (get |
| the difference between two temperatures)                                |
| 5 Unit.new('50 tempC') - Unit.new('100 tempC') # '-50 degC'.to_unit     |
| 6 Unit.new('100 tempC') * scalar # '100*scalar tempC'.                  |
| to_unit                                                                 |
| 7 Unit.new('100 tempC') / scalar # '100/scalar tempC'.                  |
| to_unit                                                                 |
| 8 Unit.new('100 tempC') * unit # exception                              |
| 9 Unit.new('100 tempC') / unit # exception                              |
| 10 Unit.new('100 tempC') ** N # exception                               |
| 11                                                                      |
| 12 Unit.new('100 tempC').convert_to('degC') #=> Unit.new('100 degC')    |

| 1 Unit.define("foobar") do |foobar|                           |
|:--------------------------------------------------------------|
| 2 foobar.definition = Unit.new("1 foo") * Unit.new("1 bar") # |
| anything that results in a Unit object                        |

3 foobar.aliases = %w{foobar fb} # array of
synonyms for the unit
4 foobar.display_name = "Foobar" # How unit is
displayed when output
5 end
Redefine Existing Unit Redefining a unit allows the user to change a single aspect of a definition
without having to re‑create the entire definition. This is useful for changing display names, adding
aliases, etc.
1 Unit.redefine!("cup") do |cup|
2 cup.display_name = "cup"
3 end
Useful methods
1. scalar will return the numeric portion of the unit without the attached units
2. base_scalar will return the scalar in base units (SI)
3. units will return the name of the units (without the scalar)
4. base will return the unit converted to base units (SI)
Storing in a database
Unitscanbestoredinadatabaseaseitherthestringrepresentationorintwoseparatecolumnsdefin‑
ing the scalar and the units. Note that if sorting by units is desired you will want to ensure that you
are storing the scalars in a consistent unit (i.e, the base units).
Namespaced Class
Sometimesthedefaultclass‘Unit’mayconflictwithothergemsorapplications. Internallyruby‑units
defines itself using the RubyUnits namespace. The actual class of a unit is the RubyUnits::Unit. For
simplicityandbackwardscompatibility,the::Unitclassisdefinedasanaliasto::RubyUnits::
Unit.
To load ruby‑units without this alias…
1 require 'ruby_units/namespaced'
When using bundler…
6

| 3 foobar.aliases = %w{foobar fb} # array of    |
|:-----------------------------------------------|
| synonyms for the unit                          |
| 4 foobar.display_name = "Foobar" # How unit is |
| displayed when output                          |
| 5 end                                          |

| 1 Unit.redefine!("cup") do |cup|   |
|:-----------------------------------|
| 2 cup.display_name = "cup"         |
| 3 end                              |

1 gem 'ruby-units', require: 'ruby_units/namespaced'
Note: when using the namespaced version, the Unit.new('unit string') helper will not be
defined.
Configuration
Configuration options can be set like:
1 RubyUnits.configure do |config|
2 config.separator = false
3 end
Currently there is only one configuration you can set:
1. separator (true/false): should a space be used to separate the scalar from the unit part during
output.
NOTES
Performance vs. Accuracy Ruby units was originally intended to provide a robust and accurate
way to do arbitrary unit conversions. In some cases, these conversions can result in the creation and
garbagecollectionofalotofintermediateobjectsduringcalculations. Thisinturncanhaveanegative
impact on performance. The design of ruby‑units has emphasized accuracy over speed. YMMV if you
are doing a lot of math involving units.
License
7

| 1 RubyUnits.configure do |config|   |
|:------------------------------------|
| 2 config.separator = false          |
| 3 end                               |