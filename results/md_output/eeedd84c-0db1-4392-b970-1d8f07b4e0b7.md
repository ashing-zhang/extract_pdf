Co-existence of Trend and Value
in Financial Markets:
Estimating an Extended Chiarella Model
Adam A. Majewski, Stefano Ciliberti and Jean-Philippe Bouchaud∗
8102 luJ 13  ]TS.nif-q[  1v15711.7081:viXra
Capital Fund Management
23 rue de l’Université
Paris 75007, France
August 1, 2018
Abstract
Trend and Value are pervasive anomalies, common to all financial markets.
We address the problem of their co-existence and interaction within the frame-
work of Heterogeneous Agent Based Models (HABM). More specifically, we
extend the Chiarella (1992) model by adding noise traders and a non-linear
demand of fundamentalists. We use Bayesian filtering techniques to calibrate
the model on time series of prices across a variety of asset classes since 1800.
The fundamental value is an output of the calibration, and does not require the
use of an external pricing model. Our extended model reproduces many em-
pirical observations, including the non-monotonic relation between past trends
and future returns. The destabilizing activity of trend-followers leads to a qual-
itative change of mispricing distribution, from unimodal to bimodal, meaning
that some markets tend to be over- (or under-) valued for long periods of time.
∗All authors would like to thank André Breedt, Yves Lempérière, Marco Leoni, Iacopo Mas-
tromatteo, Adam Rej, Philip Seager and Emmanuel Sérié for insightful comments and fruitful dis-
cussions. Moreover, we are grateful to participants of Imperial ETH Workshop on Mathematical
Finance 2018 in Zurich and seminar in Capital Fund Management for helpful remarks.
1

”Nowadays people know the price of everything and the value of nothing.”
Oscar Wilde, The Picture of Dorian Gray
1 Introduction
Among the most challenging anomalies for the efficient market hypothesis are the
so-called ‘Trend’ and ‘Value’ effects, that pervade all financial markets (see e.g. As-
ness et al. (2013)). Trend means that positive (negative) returns over a short to
medium period are likely to be followed by positive (negative) short-term return.
Value means that assets with prices lower (higher) than their ‘fundamental value’
tend to have positive (negative) future returns. While the former anomaly essentially
implies positive autocorrelations of short to medium-term returns (weeks to months),
the latter implies a negative correlation of long term returns (corresponding to price
mean-reversion on a multi-year time scale). Both anomalies have been extensively
validated statistically in the empirical literature for various types of assets.1 The
present paper studies the qualitative and quantitative nature of these two effects and
their interaction, within the framework of an Agent-Based inspired model.
Having acknowledged the existence of a trend effect, it is interesting to investigate
the structure of the relation between past and future returns. In two recent papers,
Lempérière et al. (2014) and Bouchaud et al. (2017) present empirical evidence that
this relation is non-linear and surprisingly non-monotonic. The trend effect saturates
for larger trend signals, and even appears to invert for very large trend signals. The
first goal of our study is to introduce a mechanism that leads to such an effect. The
intuitive explanation of this phenomenon is that when trend signals are very strong it
is very likely that the price is far away from the fundamental value. Fundamentalists
(i.e. investors believing in value) then become more active, causing price mean-
reversion, overriding the influence of chartists (or trend-followers). It is therefore
natural to approach this problem within the framework of heterogeneous agent-based
market models.
The cornerstone of classical financial theory is the existence of a representative
investor with rational expectations. This paradigm has been questioned and rejected
1The first ones to advocate for value investing were Graham and Dodd (1934). Later on, the
value anomaly was investigated by many researchers, among which De Bondt and Thaler (1985),
Rosenberg et al. (1985), Summers (1986), Campbell and Shiller (1988), Fama and French (1992),
Lakonishok et al. (1994), Bouchaud et al. (2017). The trend effect was documented by Jegadeesh
(1990), Lehmann (1990), Jegadeesh and Titman (1993), Carhart (1997), Moskowitz et al. (2012),
Lempérière et al. (2014) and others. Value and trend effects together were statistically validated by
Fama and French (2012) and Asness et al. (2013).
2

by many scholars who have provided evidence that investors are in fact heterogeneous
and at best boundedly rational (see e.g. Shiller (1987), Thaler (1993), Daniel et al.
(1998), Thaler (2005), Kahneman (2011), Landier et al. (2017) and many others). In
order to meet these empirical findings, the HABM literature assumes the existence of
several types of investors with simple investment heuristics, that interact with each
other via market prices. For reviews on HABMs see Hommes (2006), LeBaron (2006),
Chiarella et al. (2009) and Dieci and He (2018).
In this paper we assume that market clearing is done by a price impact mech-
anism. In that case, the accumulated demand functions of investors are crucial for
determining the price dynamics. Two elements seem necessary to obtain the non-
monotonic shape of the trend effect: i) a bounded demand of trend-followers that are
active for small and medium trend signals, before saturating for large signals; and ii)
a demand of fundamentalists that grows with increasing mispricing. The model of
(Chiarella, 1992) encapsulates these features, and is therefore able to reproduce the
desired shape of the trend effect. We modify the original model of (Chiarella, 1992)
by allowing the fundamental value to have a long term drift, and by adding a third
group of agents, which represent noise traders. This leads to a more realistic price
dynamics.
The second goal of our paper is to model and measure the value effect. A detailed
analysis reveals the non-linear nature of this effect. It seems natural that profits from
value investing grow proportionally to the difference between price and fundamen-
tal value. However, a model with such a linear demand of fundamentalists fails to
reproduce some aspect of the data. On the other hand a non-linear demand of funda-
mentalists implies a non-linear shape of the value effect, similar to the one observed
empirically.
Finally, one would like to know how often, and by how much, markets are over/under-
valued. In his famous paper, Black (1986) suggested that prices are typically ‘a factor
2’ away from value, a conclusion bolstered by the analysis of Bouchaud et al. (2017),
who report 50 % typical mispricings and a time scale of several years for markets
to self-correct. Recently, Schmitt and Westerhoff (2017) presented evidence that the
distribution of price distortion of S&P 500 is actually bimodal, with a local minimum
of probability distribution around zero. That is a very surprising discovery suggesting
that market is more often overvalued or undervalued than close to fundamental value.
We confirm that our model-implied price distortion has a bimodal distribution for cer-
tain assets. It is worth stressing that the proposed agent-based model indeed exhibits
a phenomenological bifurcation. The qualitative change of mispricing distribution,
from unimodal to bimodal, emerges when the destabilizing activity of trend-followers
exceeds the trading activity of fundamentalists (see a related discussion in Bouchaud
et al. (2018), Chapter 20).
We estimate our HABM on a rich and diverse dataset (stock indices, commodi-
3

ties, FX rates and government bonds) going back to 1800. The main challenge in
estimating HABM is that fundamental value is not an observable quantity. HABM
models are often calibrated by first estimating fundamental value using an additional
economic model (for example the model of Gordon (1962) for stock markets) and
then estimating the parameters of the HABM model by standard econometric meth-
ods like OLS or maximum likelihood (see Boswijk et al. (2007), Chiarella et al. (2014)
and others). Another approach to HABM estimation is via the method of simulated
moments, which searches for the parameter setting such that simulated moments and
other statistics match the ones observed in the data (Franke and Westerhoff, 2011,
2016; Barde, 2016; Ghonghadze and Lux, 2016). Recently, independently from our
own research, a new approach has been proposed by Lux (2017) and Bertschinger
et al. (2018).2 Both papers treat the unobserved quantities as hidden variables that
are estimated using particle filtering. The parameters of the system are determined
by a numerical black-box procedure maximizing the likelihood given the filtered-out
hidden variables.
Our estimation approach falls into the last category. We treat the fundamental
value of the asset as the hidden variable and we filter it out using Bayesian filtering
techniques. Contrary to Lux (2017) and Bertschinger et al. (2018), who use compu-
tationally expensive particle filtering, we apply a classical Kalman filter to the model
with a linear value demand function and an Unscented Kalman Filter to the non-
linear version of the model. Moreover, for the linear demand function we apply the
Expectation-Maximization (EM) algorithm that provides closed-form formulas for it-
erative procedure maximizing likelihood of the model. The advantage of Bayesian
filtering methods over a method of simulated moments is both higher precision of
parameter estimates and the possibility of identification of the hidden variables tra-
jectories that are of crucial conceptual importance in most agent-based models. We
also find the Bayesian filtering approach more consistent and more universal than
estimating first a fundamental value using an additional economic model and then
estimating the HABM: our approach does not need any additional assumption on the
fundamental value process and can thus be applied to all asset classes.
The rest of the paper is organized as follows. In Section 2 we review the literature
related to trend and value anomalies, and HABMs. Section 3 introduces our version
of the Chiarella HABM, with a linear demand of fundamentalists. In the same section
we provide some basic properties of the model (Subsection 3.2) and we describe the
estimation methodology (Subsection 3.3). Subsection 3.4 describes the model-implied
trend and value effects and compares them with the ones observed in the data. Section
4 extends the model by considering a non-linear demand function of fundamentalists.
2Another interesting approach to HABM estimation is via modern machine learning techniques,
see Lamperti et al. (2017).
4

In Section 5 we analyze the statistical properties of the stationary distribution of
mispricing. Section 6 concludes.
2 Related Literature
2.1 Interpretations of the Trend and Value Anomalies
The economic rationale for the trend and value anomalies is one of the most debated
problems in modern finance theory. The classical branch of finance literature based on
the efficient market hypothesis has serious difficulties in explaining the existence and
nature of these two anomalies, especially trend which is often denied or swept under
the rug.3 Even if in principle one cannot reject the existence of a risk-based asset
pricing theory that would accommodate the trend effect, there is no clear identification
of the risk that could be responsible for excess returns of the trend-following strategy.
Indeed, macroeconomic variables such as the business cycle, or consumption, have
been rejected as potential risk variables to explain it (Griffin et al., 2003; Asness
et al., 2013).4 Moskowitz et al. (2012) and Dao et al. (2017) show that the trend-
following strategy performs best when the price experiences large up and down moves,
which rules out the possibility that the trend effect is a compensation for crash risk
or tail events. The most plausible evidence of a link between risk and trend-following
returns is illiquidity risk (Pástor and Stambaugh, 2003; Sadka, 2006; Moskowitz et al.,
2012). However, even in that case, the transaction cost factor can only explain a small
fraction of abnormal returns of trend-followers. Finally, Lempérière et al. (2017) show
that the trend-following strategy has a positive skewness, which is at odds with the
interpretation of trend excess returns as a risk premium of sorts (see also Dao et al.
(2017)).
The problems encountered by classical theories to provide a satisfactory expla-
nation for the trend and value anomalies have stimulated alternative approaches to
modelling financial markets in the past three decades. One attempt is to relax the
assumption of a representative investor by introducing heterogeneity of market partic-
ipants. For example, Andrei and Cujean (2017) propose a theory based on information
percolation in an heterogeneous market setting. In the model of Barroso et al. (2017)
the trend effect is generated by the crowding behavior of investors.
3The momentum factor is so at odds with Fama’s view of the world that it is not included in the
most recent 5 factor version of the Fama-French model! See Fama and French (2016).
4Of note, there is also some evidence of macroeconomic risks, like industrial production, explain-
ing a trend effect (Liu and Zhang, 2008). Assuming that those results are not spurious due to
extensive data mining, the proposed rational asset pricing models can only explain the trend effect
for single-name equities. Since one observes the presence of the anomaly over all asset classes, we
feel that a more general approach is needed.
5

Vayanos and Woolley (2013) propose an interpretation of trend and value anoma-
lies based on delegated management. According to this theory investors try to learn
about a portfolio manager’s skill from his past performance and effectively chase re-
turns. In this scenario, fund managers are prone to moral hazard – even if they are
aware of a bubble, they prefer to herd with the mass of investors as it is bringing
short-term profits. Going with the flow is safe – for example, no manager was fired
for holding tech stocks during the dot-com bubble in late 90s. On the other hand,
going against the flock of investors can be financially damaging in the short-term.
Since value strategies pay off slowly, unevenly and only over long horizons, impatient
investors are likely to withdraw their funds from managers not following the trends.
As a result, managers have an incentive to herd and fund flows push prices away from
fair values, thus inducing short-term momentum. This approach is in its infancy and
it is hard to judge its ability to explain the mechanism beyond the two effects since
it has not been tested on financial data. Note that this mechanism relies, in fine, on
strong behavioral biases affecting final investors.
More generally, as already mentioned in the introduction, there are many reasons
to think that investors do not act rationally. Behavioral finance literature presents
a long list of cognitive biases that may lead to irrational decisions. Conservatism
bias, defined as the slow updating of beliefs in the face of new information (Edwards,
1968), may lead to investors’ underreaction. A similar cognitive bias, also leading to
underreaction, is anchoring (Tversky and Kahneman, 1974), the tendency of people
to assess probabilities by starting with an implicitly suggested reference point (the
‘anchor’) and making small incremental adjustments based on new evidence to reach
their final estimate heavily biased by the initial anchor. Kahneman and Tversky
(1973) find that people are prone to recency bias – a tendency to assign more im-
portance to more recent observations compared to those further in the past. Market
overreaction can be caused by a number of biases: one example is representativeness
bias – the tendency of people to categorize some events as typical or representative
and ignore the laws of probability (Tversky and Kahneman, 1974). Another behavior
leading to overreaction is self-attribution bias – taking credit for positive returns of
an investment strategy as proof of one’s own skill, but blaming bad luck for losses
(Bem, 1965).
Two notable examples of behavioral finance models for trend & value are Barberis
et al. (1998) and Hong and Stein (1999). The first stage in both models is underreac-
tion to arriving economic news, caused by the conservatism bias of investors. In the
second phase, both models have some overreaction that drives the prices far away from
the fundamental value. Finally price reversal occurs. In the model of Barberis et al.
(1998) overreaction is a consequence of the representativeness bias among investors,
while in Hong and Stein (1999) part of the investors are trend-following causing the
overreaction. Another prominent behavioral finance model is Daniel et al. (1998),
6

which is motivated by different cognitive biases: overconfidence and self-attribution.
In this model investors are over-confident about their private signals. When the price
changes are in line with their prediction, they attribute it to their own skills and
become even more over-confident, creating further short-term trends. In the famous
behavioral model of De Long et al. (1990), trend effect is attributed to investor sen-
timent and recency bias in forecasting.
2.2 Agent-Based Models
One of the weaknesses of these behavioral finance models is that it is not clear how
the biases of individual investors at the micro level translate into price dynamics at
the macro level. On the other hand, the link between micro- and macro-levels is the
central object of the Agent-Based Model (ABM) approach. For these reasons, agent-
based technologies are well suited for testing behavioral theories (LeBaron, 2006).
Much like behavioral finance, the ABM approach does not assume that investors
are rational. Rather, financial markets are viewed as complex evolving systems with
interacting groups of boundedly rational, heterogeneous agents who follow simple
‘rule of thumb’ strategies (LeBaron, 2006). It is a ‘bottom-up’ approach – the micro
interactions of agents are pieced together to give rise to a macro dynamics of the whole
economy. It has been shown that ABM are able to replicate and explain a variety
of stylized facts of financial markets, like excess volatility, volatility clustering, fat-
tails of returns (see for example Lux (1998), Lux and Marchesi (1999), Giardina and
Bouchaud (2003), Challet et al. (2013) and Hommes and LeBaron (2018)).
One type of traders in agent-based models are trend-followers with extrapola-
tive expectations: their beliefs on future prices are formed by extrapolating recent
trends in price. For example, Landier et al. (2017) provide quantitative evidence that
investors are more prone to extrapolative expectation than to under-reaction bias.
Extrapolative expectations are related to recency bias, as in Kahneman and Tver-
sky (1973). The self-referential behavior of trend-followers creates trends and moves
price away from the fundamental value, as in Wyart and Bouchaud (2007). When the
market price is far away from the fundamental value, a second group of traders, the
fundamentalists, step in and take opposite positions, thus creating the price reversal
responsible for the value effect (Chiarella (1992); Lux (1998)).
The great advantage of ABMs is that they offer a description of the resulting
price dynamics. It can be provided as a solution of a nonlinear dynamical system,
where bifurcation and chaos theories may be applied to help understand the resulting
model dynamics. This approach is called analytical and in this group of ABM one
can include the seminal models of Beja and Goldman (1980), Chiarella (1992), Brock
and Hommes (1997, 1998), Lux (1998), and later models by Chiarella and He (2001),
Chiarella et al. (2002, 2006), Wyart and Bouchaud (2007). The second approach
7

consists in studying the price dynamic by numerically simulating agents’ behavior.
This computational approach is considered in a very large number of works, starting
from the so-called Santa-Fe models (see LeBaron et al. (1999) and for a recent review
Hommes and LeBaron (2018)).
Another classification of ABMs is with respect to the price setting mechanism. The
most common price setting mechanisms are (i) Walrasian-type market clearing and
(ii) price impact. Examples of ABM with Walrasian clearing are Brock and Hommes
(1997, 1998). In price impact mechanism models, one typically postulates a linear
relation between excess aggregate demand and price changes, which describes the be-
havior of a Kyle market maker (see Kyle (1985)). Among models with a price impact
mechanism, one can cite Beja and Goldman (1980), Chiarella (1992), Bouchaud and
Cont (1998), Giardina and Bouchaud (2003), Wyart and Bouchaud (2007).
3 An Extended Chiarella Model
3.1 Model Set-Up
We will denote the log-price of an asset at time t as P . We assume that the price
t
dynamics is governed by a linear price impact mechanism: the price change from t to
t + ∆ is linear in the cumulative demand imbalance (total signed volume traded on
the market) in the same period, which we denote as D (t,t + ∆). This can be written
as
P − P = λD (t,t + ∆), (3.1)
t+∆ t
where λ is ‘Kyle’s lambda’, and is inversely proportional to the liquidity of the market
(Kyle, 1985).
The aggregated demand of investors depends on the investment strategies of mar-
ket participants, which we assume are heterogeneous in their investment decisions, as
postulated in the early HABMs of Chiarella (1992); Lux (1998); Lux and Marchesi
(1999). The empirical research of Boswijk et al. (2007) on the S&P 500 index from
1871 until 2003 provides evidence that the two largest groups of investors active in
the market are fundamentalists, betting on mean reversion of stock prices towards
the fundamental value, and chartists betting that trends will continue. Consistent
with these observations, we classify agents as fundamentalists, trend-followers and
noise traders – i.e. agents with trading strategies uncorrelated with the future price
change.
Trend-followers A commonly used trend signal, M , is the exponentially weighted
t
moving average of past log-returns with decay rate α. Following Chiarella (1992) we
˜
assume that the demand function of trend-followers is given by β tanh(γM ) with
t
8

γ > 0. Parameter γ describes the saturation of chartists’ demand for large signals,
induced for example by risk aversion and/or budget constraints. For trend signals
larger than γ−1 trend-followers’ demand becomes almost constant.
˜
The overall weight of trend-followers in the market is captured by parameter β.
˜
Consistently with the behavior of trend-followers, we assume that β > 0, i.e. the
demand of chartists is positive (negative) if trend is positive (negative) and it is an
increasing function of trend.
Fundamentalists The investment strategy of fundamentalists is based on the per-
ceived intrinsic (or fundamental) value of the asset, V . A value trader will buy an
t
asset whenever it is under-priced according to her beliefs (V −P > 0). She will sell it
t t
otherwise. Following Beja and Goldman (1980), Chiarella (1992) and Bouchaud and
Cont (1998) we assume in this section that the aggregated demand of fundamentalists
is linear in mispricing, i.e. given by κ˜ (V − P ), where κ˜ describes the overall weight
t t
of fundamentalists in the market. A non-linear extension will be considered in Section
4.
Noise-traders The last group of traders are noise traders, who either have different
investment horizon than we are considering (months) or are following investment
strategies different than trend-following or value investing. The cumulative demand
(N)
of noise traders is described by Brownian Motion, W , multiplied by σ˜ , which
t N
describes the size of noise traders in the market.
Model Dynamics The total demand of all three groups of investors is then given
by
t+∆ t+∆ t+∆
(cid:90) (cid:90) (cid:90)
D (t,t + ∆) = κ˜ (V − P )ds + β˜ tanh(γM )ds + σ˜ dW(N). (3.2)
s s s N s
t t t
Furthermore, we assume that the (log-)fundamental value is driven by a diffusion
with volatility σ and average growth g. The resulting price dynamics for ∆ → 0 is
V
described by a stochastic dynamical system:
(N)
dP = κ(V − P )dt + β tanh(γM )dt + σ dW ,
t t t t N t
dM = −αM dt + αdP , (3.3)
t t t
(V)
dV = gdt + σ dW ,
t V t
˜
where κ, σ , β are equal to λκ˜, λσ˜ , λβ, respectively. Observe that for g = 0
N N
and σ = 0 we recover the model of Chiarella (1992). The dynamics produced by
N
9

similar ABMs with linear demand functions was investigated in Beja and Goldman
(1980), and for ABMs with non-linear demand of trend-followers in Bouchaud and
Cont (1998).
3.2 The deterministic case: Non-linear oscillations
In this section we briefly review the mathematical properties of model (3.3). We
start our considerations by assuming σ = σ = g = 0. In that case the system
N V
is deterministic and the dynamics of the trend signal is described by a second-order
differential equation:
d2M dM
t t
+ G (M ) + ακM = 0, (3.4)
t t
dt2 dt
where
(cid:0) (cid:1)
G (x) := α + κ − αγβ 1 − tanh2 (γx) . (3.5)
Equation (3.4) with a general function G is called the Liénard equation and the
famous Van der Pol oscillator is the special case where G (x) = µ(x2 − 1). In theory
of non-linear oscillations the function G is called damping force. If
α + κ − αγβ < 0, (3.6)
then for small |M |, the damping G(M ) is negative, which will make |M | increase
t t t
with time. For large trend signal in absolute value, the damping force is positive
and large, which will make |M | decrease with time. Naturally, this phenomenon will
t
cause non-linear oscillations of trend signal for the set of parameters satisfying (3.6).
It is more subtle to show that (3.4) has a unique non-degenerate periodic solution.
The Levinson-Smith theorem states that if (3.6) is satisfied then the dynamic system
(M ,R ), where R = dM /dt, has a unique and stable limit cycle surrounding the
t t t t
origin in the phase plane. Consequently, M has a unique periodic solution. Other-
t
wise, if (3.6) is not satisfied, the system (M ,R ) converges to the origin which is the
t t
critical point of the system. Figure 1 shows the limit cycle generated by the system
(3.4) in the δ − M plane, where δ = P − V is the price distortion. There is no closed
formula for the shape of the limit cycle. Establishing the properties of limit cycles is
still an area of active research. More details about the geometry of limit cycles and
the dynamic analysis of the system can be found in Chiarella (1992); Chiarella et al.
(2008).
To obtain an economic interpretation of the non-linear oscillations we rewrite the
condition (3.6) as κ < α (γβ − 1). Here we immediately observe that the trading
activity of trend-followers is the force boosting oscillations, while fundamentalists are
damping it. The oscillations are stronger for longer trend horizons (α small), faster
10

dδ
=0
dt
1.0
dM
=0
dt
0.5
δ 0.0
−0.5
−1.0
−0.100−0.075−0.050−0.025 0.000 0.025 0.050 0.075 0.100
M
Figure 1: Limit cycle. δ = P − V denotes price distortion.
saturation of trend-followers demand (γ large) and larger weight of trend-followers
in the market (β large). A larger weight κ of fundamentalists weakens the price
oscillations, to the point that, if κ ≥ α (γβ − 1), then the price simply relaxes towards
the fundamental equilibrium with no oscillations at all.
Figure 2 shows the trajectories of price (P ), fundamental value (V ) and trend
t t
signal (M ) for a set of parameters satisfying condition (3.6). In the left part we
t
present the evolution of price and trend when value is constant and there are no
noise traders. We observe that price is oscillating around the fundamental value. The
oscillations are driven by two competing forces: value and trend. When the price is
near value the trend forces are pushing the price away from its value. When the price
of an asset walks too far from its fundamental value, fundamentalists are enforcing
mean-reversion. The situation is similar in the stochastic case but less clear (and more
realistic!) due to the noise. In that case we describe the properties of the system by
analyzing its stationary distributions in Section 5.
3.3 Model calibration
3.3.1 Data
We estimate the model on large pool of monthly spot prices belonging to four types
of assets classes: stock indices, commodities, fixed income and currencies. Our aim is
to investigate as diverse a universe of assets as possible. At the same time, to increase
11

6.0 P 8 P
V V
5.5 7
6
5.0
5
4.5
4
4.0
0 20 40 60 80 100 120 140 0 20 40 60 80 100 120 140
(a) Price and value in a deterministic setting. (b) Price and value in a stochastic setting.
0.15 M
0.075
0.10
0.050
0.05
0.025
0.000 0.00
−0.025 −0.05
−0.050
−0.10
−0.075
M −0.15
0 20 40 60 80 100 120 140 0 20 40 60 80 100 120 140
(c) Trend signal in a deterministic setting. (d) Trend signal in a stochastic setting.
Figure 2: Trajectories of price, fundamental value and trend signal for model 3.3 with parameters:
κ = 0.08, β = 0.1, γ = 50.0, v = 5.0, g = 0.0. On the left: σ = σ = 0.0, on the right: σ = 0.15
0 N V N
and σ = 0.075.
V
the robustness of our results, we will choose only the time series with long enough
history. Therefore, for indices, bonds and currencies, we consider the following seven
countries: Australia, Canada, Germany, Japan, Switzerland, the United Kingdom
and the United States. For currency exchange rates we consider only pairs versus the
US dollar. Our commodities data consist of crude oil, Henry Hub natural gas, corn,
wheat, sugar, live cattle and copper. Our source of spot prices is Global Financial
Data. This is the dataset considered in Lempérière et al. (2014).
We constrain our time series only to periods when the asset are freely traded with
high liquidity. For that reason we will limit the time series of currency exchange rates
from 1973. From 1945 to 1973 all currencies were pegged to the US dollar inside
the Bretton Woods system. We consider only government bonds yields after 1920,
as before they were not liquidly traded. The emergence of a stable government debt
12

|    |    |    |    |    |    |    |    |    |    |
|:---|:---|:---|:---|:---|:---|:---|:---|:---|:---|
|    |    |    |    |    |    |    |    |    | P  |
|    |    |    |    |    |    |    |    |    | V  |

|    |    |    |    |    |    |    |    |    |    |
|:---|:---|:---|:---|:---|:---|:---|:---|:---|:---|
|    |    |    |    |    |    |    |    |    | P  |
|    |    |    |    |    |    |    |    |    | V  |

|    |    | None   |    |    |    |    |    |    |    |
|:---|:---|:-------|:---|:---|:---|:---|:---|:---|:---|
|    |    |        |    |    |    |    |    |    |    |
|    |    |        |    |    |    |    |    |    |    |
|    |    |        |    |    |    |    |    |    |    |
|    |    |        |    |    |    |    |    |    |    |
|    |    |        |    |    |    |    |    |    |    |
|    |    |        |    |    |    |    |    |    |    |
|    | M  |        |    |    |    |    |    |    |    |

|    |    |    |    |    |    |    |    |    | M   |
|:---|:---|:---|:---|:---|:---|:---|:---|:---|:----|
|    |    |    |    |    |    |    |    |    |     |
|    |    |    |    |    |    |    |    |    |     |
|    |    |    |    |    |    |    |    |    |     |
|    |    |    |    |    |    |    |    |    |     |
|    |    |    |    |    |    |    |    |    |     |
|    |    |    |    |    |    |    |    |    |     |
|    |    |    |    |    |    |    |    |    |     |

market coincided with the creation of modern central banks that pursue monetary
policy independently from the political authority of the country.
Time series of spot prices of equity indices and commodities do not suffer from
similar limitations and the available history of prices is over 200 years. From all com-
modities series we will only exclude the period of World War II and from Crude Oil we
exclude additionally period 1939-1985, when the price of oil was fixed. Equity indices
have witnessed large jumps due to political reasons. Since our model is not designed
to deal with jumps, we remove World War II period from German and Japanese in-
dices, and the period of World War I from German and British equity indices (for
Germany we also exclude the post First World War period termed ‘hyperinflation
of the Weimar Republic’). Additionally we exclude the period 1973-1974 for Great
Britain corresponding to stock market crash after the collapse of the Bretton Woods
system.
The time series of equity indices and commodities prices are inflation adjusted.
Real price of equity index at time t is obtained by multiplying the nominal price at
time t by the ratio between local CPI (Consumer Price Index) at the last observation
and CPI at time t. To obtain real prices of commodities we use US CPI.
3.3.2 Estimation: the Expectation-Maximization Algorithm
We will estimate a discrete-time version of model (3.3), where one time step is equal
to one month:
p − p = κ(v − p ) + β tanh(γm ) + (cid:15) ,
t+1 t t t t t+1
m = (1 − α)m + α(p − p ), (3.7)
t+1 t t t−1
v = v + g + η
t+1 t t+1
where (cid:15) and η are i.i.d. with normal distribution with zero mean and standard
t t
deviations, σ and σ , respectively.
N V
The correlation between the SG CTA index (formerly called Newedge CTA index)
and the P&L of trend-following strategies with different window lengths, reveals that
the typical horizon of trend computation for trend-following strategy is around six
months. For this reason we will take α = 1/(1 + τ) = 1/7, where τ = 6.5 Since the
model estimation will have difficulties pinning down the value of parameters β and
γ, we will fix γ−1 to twice the standard deviation of m of the asset. This factor 2
t
comes from the fact that saturation in trend effect starts around 2 (see Figure 4a).
The main challenge of estimating such agent-based models is the non-observability
of the fundamental value. In the economic literature there are several ways to estimate
5We have also performed the estimation for α equal 1/4 and 1/10 corresponding respectively to
3 and 9 months, with very similar results.
13

the fundamental value of a company. According to a popular finance theory (Gordon,
1962; Shiller, 2000), the fundamental value of a stock should be equal to the expected
value of discounted future dividends that the company will pay to the shareholders.
The drawback of this methodology is that one needs to make strong assumptions on
the dynamics of these dividends. Moreover, we cannot use this approach to compute
the fundamental value of assets that do not pay dividends, for example commodities.
In this paper we propose a different approach in which we estimate both the
fundamental value of an asset and the parameters of the model simultaneously. We
note that the dynamical system (3.7) is linear in v , which we treat as a hidden
t
variable of the system. For convenience and consistency with state-space literature,
let us denote by v˜ := v the fundamental value of the asset the day before t and
t t−1
η˜ := η . We can then rewrite model (3.7) as
t t−1
v˜ = g + v˜ + η˜
t+1 t t+1
(3.8)
p = p + κ(v˜ − p ) + βu + (cid:15) ,
t+1 t t+1 t t+1 t+1
where u := tanh(γm ) is a function of past prices. Treating u component as a
t+1 t t
control term of the system, we immediately see that the fundamental value v˜ can be
t
filtered out by means of a classical Kalman filter (Kalman, 1960), were the parameters
of the system known. In the case where parameters, and hidden states of the model are
not known, we can estimate both of these by applying an Expectation-Maximization
(EM) algorithm.
The algorithm is maximizing a difficult-to-compute marginal log-likelihood by
maximizing the conditional expectation of an easy-to-compute joint log-likelihood,
in a two-step iterative procedure. It alternates between one E-step that computes
a conditional expectation of joint log-likelihood on posterior distribution over the
hidden variables given prices and the parameters, and one M-step which infers the
parameters for which the expectation obtained in E-step reaches maximum. The
detailed description of the EM algorithm is provided for completeness in Appendix
B. The EM algorithm was introduced by Baum et al. (1970) for Hidden Markov
Models and it was generalized for models with incomplete observations in Dempster
et al. (1977). The EM algorithm with Kalman filter was applied for estimation of
linear dynamics system for the first time in Chen (1981) and Shumway and Stoffer
(1982).
It is quite remarkable that it is not necessary to have any economic information
about the asset (such as the dividends paid by a company) to estimate its underlying
fundamental value. It is sufficient to observe the time series of prices and assume
that its dynamics is governed by (3.7). We also note that our framework provides a
very good estimation accuracy on surrogate data and that it is more computationally
efficient than the recent approach by Lux (2017) or Bertschinger et al. (2018).
14

3.3.3 Results
In this section we present the results of our estimation procedure introduced in Sec-
tion 3.3.2, applied to the time series described in 3.3.1. To obtain a more robust
estimation procedure we will calibrate parameters in two steps. In the first step we
calibrate each time series of log-prices to obtain asset specific values of σ , g and the
N
initial fundamental value v . In the second step we search for a set parameters κ,
0
β, σ common to an asset class (i.e. one set of parameters for stock indices, one for
V
commodities, one for FX rates and one for government bonds) that maximizes the
common log-likelihood.
In Table 3 (see Appendix A) we report the results from the EM estimation of
model (3.7) with T-statistics of estimated parameters in Table 4 (see Appendix A).
From this table we observe that for all assets σ is substantially larger than σ . This
N V
confirms that noise traders provide an important contribution to the volatility and
that it is crucial to include them in the HABM. This feature can be also viewed as
another piece of evidence for the famous ‘excess volatility puzzle’ first reported by
Shiller (1980).
7.5 price
value (HABM)
7.0
value (Gordon)
6.5
6.0
5.5
5.0
4.5
4.0
5 5 5 5 5 5
1 5 9 3 7 1
8 8 8 9 9 0
1 1 1 1 1 2
Figure 3: Log-level of the US stock index, together with the smoothed fundamental value as
obtained from model (3.3) with parameters in Table 3. We also plot value plus/minus standard one
deviation of the estimation interval, and the benchmark fundamental value obtained from Gordon
model.
In Figure 3 we present the smoothed estimate of fundamental value (using a
Kalman smoother) for the US stock index given the estimated parameters in Table 3.
15

We can see that market price is oscillating around the fundamental values of the asset.
Since α + κ − αγβ is found to be slightly positive, the driving force of oscillations
is the uncertainty of fundamental value and the noise traders’ activity. The price
stabilizing activity of fundamentalists is not strong enough (relatively to the level of
noise and activity of trend-followers) to prevent oscillations.
To compute a fundamental value benchmark for the US index we apply the model
of Gordon (1962). According to this model the fundamental value of an equity asset
is the present value of dividends and is computed from the actual subsequent real
dividends using a constant real discount rate of 6.8% per year, equal to the historical
average real return on the market since 1871.6 For dividends after December 2014, it
is assumed that these will themselves grow forever from the last observed dividend,
with a growth rate of 2.2% percent per year (which is the dividends’ average growth
rate since 1871).
From Figure 3 we can observe that the benchmark fundamental value is 1-σ below
our own estimate from 1871 till 1950’s. Since then, the discrepancy estimates diverge
more strongly, with values obtained with Gordon’s model suggesting that the S&P
500 is systematically, and substantially overpriced since 70’s. Some authors assume
the future dividend growth to be equal to average dividends growth over some short
recent period (for example 10 years in Schmitt and Westerhoff (2017)). This choice
of dividends growth is justified by the increase of dividends growth during the last
decades. As a consequence, the divergence between our estimates and the Gordon
model can be mitigated. However, we find this approach inconsistent and non-robust,
and is another argument in favor of our estimation methodology.
3.4 Trend and value effects
We repeated the analysis of Bouchaud et al. (2017), who showed that monthly returns
p − p can be fitted by a cubic polynomial of the past trend signal m , defined as
t+1 t t
before. Figure 4a confirms that the relation between trend signals and future log-
returns is non-monotonic, and quite well reproduced by the model with the parameters
in Table 3. The coefficients of the regression are reported in the second row of Table
1. The adjusted R-square of the regression is 1.3% and it is substantially higher than
for linear regression (row one of Table 1). Negative cubic coefficient suggests that
large moves (in absolute value) tend to mean-revert.
A careful analysis of the value effect reveals some non-linearities, not well ac-
counted for by the model. Contrary to the trend effect, the estimation of the value
effect is model-dependent since V has to be extracted from the calibration procedure
6We take the dividend data from Shiller’s dataset, available at
http://www.econ.yale.edu/∼shiller/.
16

0.15 data data
simulation 1.0 simulation
0.10
0.5
0.05
nruter nruter
0.00 0.0
−0.05
−0.5
−0.10
−1.0
−0.15
−4 −3 −2 −1 0 1 2 3 4 −4 −3 −2 −1 0 1 2 3 4
M V−P
(a) Trend effect (b) Value effect
Figure 4: Left plot: regression of log-returns on the trend signal m for real data (second row
t
of Table 1) and simulated using the calibrated model, with the parameters in Table 3. Right plot:
regression of log-returns on the value signal V −P for real data (with V implied by the model) and
simulated using the same model.
itself. In Figure 4b we plot the value effect using real data and the fundamental
value V implied by our HABM, and compare it with the same quantity obtained
from a simulation of the model. We see that the restoring force towards V is clearly
non-linear and increases at large mispricing. In order to account for this observation,
we will consider in the next section an extended model with a non-linear demand
function of fundamentalists.
The analysis of the trend and value effects together delivers important messages.
In Table 1 we report the result of regressions of log-returns with several configurations
of regressands composed of trend and mispricing. We observe that in the configura-
tion with all regressands, the cubic term m3 becomes smaller in absolute value and
the linear component larger, with respect to a regression with only the trend com-
ponent. Consistently with intuition, the non-linear mean-reversion contribution to
trend apparent in Fig. 4a (Left) disappears when we control for the value effect, as is
replaced by a saturation effect – compare Figures 4a and 5a. In other terms, when we
condition our observations to a price distortion equal to zero, the contrarian behavior
for large trend signals disappears.
Finally, the value effect also changes when controlling for the trend. We can see
that the linear component of the value effect becomes larger if we add the trend
signal as regressand (compare Figure 5b with Figure 4b). This suggests that trend-
followers are an important force reducing the expected return of value investors for
small price discrepancies, reducing the incentive for such investors to step in. On the
other hand, observe that the value effect is stronger for large price distortions, even
17

|    |    |    |    |    |    |    |    |         |    |
|:---|:---|:---|:---|:---|:---|:---|:---|:--------|:---|
|    |    |    |    |    |    |    | d  | ata     | n  |
|    |    |    |    |    |    |    | si | mulatio |    |

|    | dat   | a       |    |    |    |    |    |    |    |
|:---|:------|:--------|:---|:---|:---|:---|:---|:---|:---|
|    | sim   | ulation |    |    |    |    |    |    |    |
|    |       |         |    |    |    |    |    |    |    |
|    |       |         |    |    |    |    |    |    |    |
|    |       |         |    |    |    |    |    |    |    |
|    |       |         |    |    |    |    |    |    |    |
|    |       |         |    |    |    |    |    |    |    |

const m m2 m3 d d3 R2
coefficient -0.000 0.024 - - - - 0.001
P-value 0.997 0.000 - - - - -
coefficient -0.003 0.068 0.001 -0.005 - - 0.013
P-value 0.631 0.000 0.710 0.000 - - -
coefficient 0.000 - - - 0.210 - 0.044
P-value 0.996 - - - 0.000 - -
coefficient 0.001 - - - 0.167 0.008 0.050
P-value 0.820 - - - 0.000 0.000 -
coefficient -0.000 0.119 - - 0.255 - 0.056
P-value 0.990 0.000 - - 0.000 - -
coefficient -0.007 0.158 0.005 -0.005 0.251 - 0.067
P-value 0.239 0.000 0.020 0.000 0.000 - -
coefficient -0.006 0.152 0.005 -0.003 0.231 0.004 0.068
P-value 0.337 0.000 0.024 0.000 0.000 0.000 -
Table 1: Regressions of log-returns on trend and value components for the model (3.3). In the last
column we present the adjusted R square of the regression.
0.4
1.0
0.3
0.2
0.5
0.1
nruter nruter
0.0 0.0
−0.1
−0.5
−0.2
−0.3
−1.0
−0.4
−4 −3 −2 −1 0 1 2 3 4 −4 −3 −2 −1 0 1 2 3 4
M V−P
(a) Trend effect controlled for value. (b) Value effect controlled for trend.
Figure 5: On the left: function F (m) = a m + a m3, where coefficients a and a are given in
t 1 3 1 3
3
the last rows of Table 1. On the right: function F (V − P) = b (V − P) + b (V − P) , where
v 1 3
coefficients b and b are given in the last rows of Tables 1.
1 3
when controlled for trend.
18

| coefficient   |   -0.000 |   0.024 | -   | -   | -   | -   |    | 0.001   |
|:--------------|---------:|--------:|:----|:----|:----|:----|:---|:--------|
| P-value       |    0.997 |       0 | -   | -   | -   | -   |    | -       |

| coefficient   |   0.000 | -   | -   | -   |   0.210 | -   |    | 0.044   |
|:--------------|--------:|:----|:----|:----|--------:|:----|:---|:--------|
| P-value       |   0.996 | -   | -   | -   |       0 | -   |    | -       |

| coefficient   |   -0.000 |   0.119 | -   | -   |   0.255 | -   |    | 0.056   |
|:--------------|---------:|--------:|:----|:----|--------:|:----|:---|:--------|
| P-value       |     0.99 |       0 | -   | -   |       0 | -   |    | -       |

| coefficient   |   -0.006 |   0.152 |   0.005 |   -0.003 |   0.231 |   0.004 |    | 0.068   |
|:--------------|---------:|--------:|--------:|---------:|--------:|--------:|:---|:--------|
| P-value       |    0.337 |       0 |   0.024 |        0 |       0 |       0 |    | -       |

|    |    |    |    |    |    |    |    |    |    |
|:---|:---|:---|:---|:---|:---|:---|:---|:---|:---|
|    |    |    |    |    |    |    |    |    |    |
|    |    |    |    |    |    |    |    |    |    |
|    |    |    |    |    |    |    |    |    |    |
|    |    |    |    |    |    |    |    |    |    |
|    |    |    |    |    |    |    |    |    |    |
|    |    |    |    |    |    |    |    |    |    |
|    |    |    |    |    |    |    |    |    |    |
|    |    |    |    |    |    |    |    |    |    |
|    |    |    |    |    |    |    |    |    |    |

|    |    |    |    |    |    |    |    |    |    |
|:---|:---|:---|:---|:---|:---|:---|:---|:---|:---|
|    |    |    |    |    |    |    |    |    |    |
|    |    |    |    |    |    |    |    |    |    |
|    |    |    |    |    |    |    |    |    |    |
|    |    |    |    |    |    |    |    |    |    |
|    |    |    |    |    |    |    |    |    |    |

4 Non-linear Fundamentalist Demand Function
4.1 Model dynamics
The model proposed in the previous section is not able to reproduce the shape of the
value effect observed in financial data. One of the reason might be the inadequacy of
a linear demand function of fundamentalists. Demand of fundamentalists depends on
many factors like attitude towards risk, perception and, more importantly, uncertainty
about fundamental value. It seems natural also to assume that fundamentalists’ de-
mand function picks up when mispricing is large, at least within some range, meaning
that the demand function is of higher order than linear. Note that this does not neces-
sarily mean that agents are risk-lovers, but rather implies that more agents following
value investing start to trade when market misvaluation becomes more evident. If
price distortion is small (|V − P | small), on the other hand, fundamentalists are not
t t
even sure about the sign of mispricing, due to a large uncertainty on the unobservable
fundamental value. Consequently, we expect fundamentalists’ demand function to be
rather flat in the region of small price distortion.
Therefore, we propose to further modify the Chiarella model by positing that the
˜
fundamentalists’ demand function f (V − P ) contains a cubic term, on top of the
t t
˜
linear term considered so far: f(x) = κ˜x + κ˜ x3, where κ˜ is presumably positive.
3 3
The linear coefficient κ˜, on the other hand, might be negative, as a result of behavioral
biases such as herding (see the discussion in Bouchaud et al. (2018), Chapter 20). We
keep the demand function of trend-followers as in the previous section.
The resulting price dynamics is now described by the following generalized stochas-
tic dynamical system:
(N)
dP = f(V − P )dt + β tanh(γM )dt + σ dW ,
t t t t N t
dM = −αM dt + αdP , (4.1)
t t t
(V)
dV = gdt + σ dW ,
t V t
where f(x) = κx + κ x3, where κ = λκ˜ , κ = λκ˜ and λ is Kyle’s impact parameter.
3 3 3
Note that when κ = 0 one recovers exactly Eq. (3.3).
3
4.2 Estimation
4.2.1 Unscented Kalman Filter
Following the same reasoning as in Section 3.3.2, we estimate the discretized version
of model (4.1)
v˜ = v˜ + g + η˜ ,
t+1 t t+1
(4.2)
p = p + f (v˜ − p ) + βu + (cid:15) .
t+1 t t+1 t t+1 t+1
19

In the present case, however, the conditional distribution of v˜ given the past prices
t
is no longer Gaussian and we cannot use Kalman filters anymore.
One can find several filtering approaches for non-linear dynamic systems in the
Machine Learning literature. For example ‘particle filtering’ (also called Sequential
Monte Carlo) amounts to simulate the dynamics of the hidden state v˜ a certain
t+1
number of times (predicting step) and then to adjust in the filtering step the weight
of each prediction based on the likelihood of observing log-price p , given the fun-
t+1
damental value obtained in simulation. This approach has been used for estimating
ABMs in Lux (2017) and Bertschinger et al. (2018). Another approach, called Ex-
tended Kalman Filter (EKF), approximates the distribution of fundamental values by
a Gaussian which is then propagated analytically through the first-order linearization
of the non-linear demand function of fundamentalists. Both approaches are described
in Durbin and Koopman (2012) or Särkkä (2013).
In this paper we will apply a third method called Unscented Kalman Filter (UKF),
introduced by Julier and Uhlmann (1997). The idea of the filter is to approximate
directly the demand of fundamentalists by a Gaussian distribution with mean and
variance determined by an Unscented Transform. Details of the UKF method are
given in Appendix C.1. The main advantage of UKF over EKF is a higher accuracy
with the same computational complexity. UKF approximates posterior mean and
covariance accurately to the 3rd order (Taylor series expansion) for any non-linearity.
EKF, in contrast, only achieves first-order accuracy.
All these filtering recipes can be applied together with EM for the identification of
non-linear dynamical systems (see Roweis and Ghahramani (2001) for EM combined
with EKF and Kokkala et al. (2014) or Kokkala et al. (2015) for EM combined with
particle filter and UKF). Unfortunately, in the case of non-linear systems we cannot
guarantee that the algorithm will converge to the local maximum of log-likelihood
as for linear systems. In fact, if our approximation of the conditional distribution
of value is too far away from the true distribution (in a Kullback–Leibler sense),
the algorithm will maximize a quantity that is substantially different from the log-
likelihood of the system.7 For this reason, instead of applying the EM algorithm we
will optimize our non-linear model with a direct likelihood maximization. Details of
estimation procedure are provided in Appendix C.
4.2.2 Results
We follow the same two-step estimation procedure as in Section 3.3.3. In the first
step we calibrate each time series of log-prices to obtain an asset specific σ , g and
N
the initial fundamental value v , while in the second step we search for a common
0
7See discussion below equation (B.5) in Appendix B.
20

set of parameters κ, κ , β for a given asset class. In order to prevent the algorithm
3
to converge to unphysical values, we fix the fundamental volatility σ to the value
V
obtained for the linear model in Section 3.3.3.
Demand function of fundamentalists
0.3
0.2
0.1
dnamed
0.0
−0.1
−0.2
−0.3
−4 −3 −2 −1 0 1 2 3 4
negative price distortion (V-P)
(cid:16) (cid:17)
Figure 6: Plot of f¯ (x) := 1 (cid:80)N f(i) xσ(i) , where f(i) is the estimated demand function of
N i=1 D
fundamentalists for asset i (f(i) (x) := κ(i)x + κ(i) x3), σ(i) is the standard deviation of the price
3 D
distortions of asset i, as implied by our non-linear model, and N is the number of assets. Note that
fundamental demand is extremely flat when mispricing is small, in agreement with intuition.
Table 5 (see Appendix A) presents the results of the direct maximum-likelihood
estimation of model (4.2). In Figure 6 we plot the demand function of fundamentalists,
standardized and averaged over all assets. The linear parameter κ is found to be
negative and significant (see T-statistics in Table 6 in Appendix A). However, Figure
6 shows that its impact on the full demand function f(x) is small: the fundamental
demand is essentially flat when P ≈ V .8 On the other hand the non-linear parameter
κ is positive and significant. It means, as anticipated, that fundamentalists tend to
3
be very active when their estimate of value is sufficiently far from the market price,
whereas they are nearly inactive when value and price are close to each other.
In Figure 7 we plot the smoothed estimate of fundamental value of US stock
index, using the Unscented Kalman smoother, as inferred from the non-linear model
(4.2) for the parameters given in Table 5. Figures 16 - 19 in Appendix A gives the
8This suggests that a better two-parameter family of demand functions might be f (x) =
µ
κ sign(x)|x|µ with µ > 1. Model with such a demand of fundamentalists has been proposed by
µ
Ide and Sornette (2002) in a different context. We have not investigated this possibility as yet.
21

|    |    |    |    |    |    |    |    |    |    |
|:---|:---|:---|:---|:---|:---|:---|:---|:---|:---|
|    |    |    |    |    |    |    |    |    |    |
|    |    |    |    |    |    |    |    |    |    |
|    |    |    |    |    |    |    |    |    |    |
|    |    |    |    |    |    |    |    |    |    |
|    |    |    |    |    |    |    |    |    |    |
|    |    |    |    |    |    |    |    |    |    |
|    |    |    |    |    |    |    |    |    |    |

7.5 price
value (HABM)
7.0
value (Gordon)
6.5
6.0
5.5
5.0
4.5
4.0
5 5 5 5 5 5
1 5 9 3 7 1
8 8 8 9 9 0
1 1 1 1 1 2
Figure 7: Log-level of the US stock index, together with the smoothed fundamental value as
inferred from the non-linear model (4.1) for the parameters given in Table 5. We also plot value
plus/minus one standard deviation of the estimation interval, and the benchmark fundamental value
obtained from Gordon model.
smoothed estimates of value for several assets, given the estimated parameters of
both the linear (3.7) and non-linear (4.2) models. We see that the fundamental value
estimated with the extended model tracks the market price better than the one found
using the linear version of the model. The reason is that the cubic demand function
of fundamentalists acts as a strong mean-reverting force when mispricing becomes
large, and therefore prevents such large excursions much more effectively than the
linear model. Correspondingly, the most likely path of value is closer to the market
price. We believe that this non-linear model makes more economic sense: not only is
the idea of a steeply increasing demand enticing, but the final output of the model
(in terms of average mispricing) is also more plausible.
4.3 Trend and value effects
Figures 8a, 8b are the counterpart, for the non-linear model, of Figures 4a, 4b in
the linear case. The regressions have been obtained using the parameters obtained
in Table 5. While the simulated trend effect is very similar to the one observed
in the data, we now find that the non-linear model over-estimates the non-linearity
of the fundamental demand for large values of |V − P|. However, when limited to
indices of equities, we observe that non-linear model provides consistent estimated and
22

const m m2 m3 d d3 R2
coefficient -0.000 0.024 - - - - 0.001
P-value 0.997 0.000 - - - - -
coefficient -0.003 0.068 0.001 -0.005 - - 0.013
P-value 0.631 0.000 0.710 0.000 - - -
coefficient 0.000 - - - 0.202 - 0.041
P-value 0.996 - - - 0.000 - -
coefficient 0.002 - - - 0.158 0.011 0.048
P-value 0.730 - - - 0.000 0.000 -
coefficient -0.000 0.127 - - 0.253 - 0.054
P-value 0.990 0.000 - - 0.000 - -
coefficient -0.007 0.172 0.005 -0.005 0.254 - 0.067
P-value 0.242 0.000 0.028 0.000 0.000 - -
coefficient -0.005 0.165 0.005 -0.004 0.223 0.008 0.070
P-value 0.347 0.000 0.021 0.000 0.000 0.000 -
Table 2: Regressions of log-returns on trend and value components for the model (4.1). In the last
column we present the adjusted R square of the regression.
simulated value effects (see Figure 9b), while linear model is not able to reproduce the
non-linearity (see Figure 9a), as we have observed for complete dataset in Section 3.4.
This again suggests that a different specification of the non-linear function f(x) could
be more adapted (for example f (x) in footnote 8 with µ being asset specific).
µ
As in Section 3.4, we now proceed to the analysis of trend and value together.
Comparing Tables 1 and 2, we notice that the model with a non-linear demand of
fundamentalists gives a higher adjusted R-square. This is further evidence that our
extended model explains the price dynamics better.
Similar to the linear version of the model, the inversion of the trend effect for
large signals morphs into a saturation when we control for value (that is, when we
condition it to P = V ), and the value effect controlled for trend becomes stronger for
small price distortion. The resulting graphs are very similar to Figures 5a and 5b, so
we do not duplicate them here.
5 The Distribution of Mispricings
Both the linear and non-linear models studied in the previous sections admit a sta-
tionary distribution for the price distortion (or mispricing) δ = P − V (remember
t t t
that both P and V are logarithms). In this section we would like to investigate further
the properties of this stationary distribution, both on real data and in simulation.
Of particular interest are (i) the variance of this distribution, which gives us an indi-
23

| coefficient   |   -0.000 |   0.024 | -   | -   | -   | -   |    | 0.001   |
|:--------------|---------:|--------:|:----|:----|:----|:----|:---|:--------|
| P-value       |    0.997 |       0 | -   | -   | -   | -   |    | -       |

| coefficient   |   0.000 | -   | -   | -   |   0.202 | -   |    | 0.041   |
|:--------------|--------:|:----|:----|:----|--------:|:----|:---|:--------|
| P-value       |   0.996 | -   | -   | -   |       0 | -   |    | -       |

| coefficient   |   -0.000 |   0.127 | -   | -   |   0.253 | -   |    | 0.054   |
|:--------------|---------:|--------:|:----|:----|--------:|:----|:---|:--------|
| P-value       |     0.99 |       0 | -   | -   |       0 | -   |    | -       |

| coefficient   |   -0.005 |   0.165 |   0.005 |   -0.004 |   0.223 |   0.008 |    | 0.070   |
|:--------------|---------:|--------:|--------:|---------:|--------:|--------:|:---|:--------|
| P-value       |    0.347 |       0 |   0.021 |        0 |       0 |       0 |    | -       |

data
10
0.10 simulation
5
0.05
nruternruter nruternruter
0.00 0
−0.05
−5
−0.10 data
simulation −10
−4 −3 −2 −1 0 1 2 3 4 −4 −3 −2 −1 0 1 2 3 4
M V−P
(a) Trend effect (b) Value effect
Figure 8: Left plot: regression of log-returns on the trend signal m for real data and simulated
t
using the calibrated model. Right plot: regression of log-returns on the value signal V − P for real
data (with V implied by the model) and simulated using the same model.
data data
0.75 simulation 4 simulation
0.50
2
0.25
0.00 0
−0.25
−2
−0.50
−0.75 −4
−4 −3 −2 −1 0 1 2 3 4 −4 −3 −2 −1 0 1 2 3 4
V−P V−P
(a) κ = 0 (b) κ (cid:54)= 0
3 3
Figure 9: Regression of log-returns of indices of equites on the value signal V − P for real data
(with V implied by the model) and simulated using the model with linear demand of fundamentalists
(left plot) and the model with non-linear demand of fundamentalists (right plot).
cation of the typical amplitude of mispricings and (ii) the shape of the distribution
(unimodal vs. bimodal).
Black (1986) conjectured that “price is more than half of value and less than twice
value”. This conjecture was recently confirmed empirically by Bouchaud et al. (2017).
In Figure 10 we plot as an illustration the time series of the log-price distortion for the
US and Canadian stock indices. Since the distortion is in natural log scale, a value
of 0.5 on the y-axis corresponds to a mispricing ratio of e0.5 = 1.65. We find that
24

|    |    |    |    | None   |    |          |    | None   |    |    |    |
|:---|:---|:---|:---|:-------|:---|:---------|:---|:-------|:---|:---|:---|
|    |    |    |    |        | da | ta       |    |        |    |    |    |
|    |    |    |    |        | si | mulation |    |        |    |    |    |

|    | dat   | a       |    |    |    |    |    |    |    |
|:---|:------|:--------|:---|:---|:---|:---|:---|:---|:---|
|    | sim   | ulation |    |    |    |    |    |    |    |
|    |       |         |    |    |    |    |    |    |    |
|    |       |         |    |    |    |    |    |    |    |
|    |       |         |    |    |    |    |    |    |    |
|    |       |         |    |    |    |    |    |    |    |
|    |       |         |    |    |    |    |    |    |    |

|    | dat   | a       |    |    |    |    |    |    |    |
|:---|:------|:--------|:---|:---|:---|:---|:---|:---|:---|
|    | sim   | ulation |    |    |    |    |    |    |    |
|    |       |         |    |    |    |    |    |    |    |
|    |       |         |    |    |    |    |    |    |    |
|    |       |         |    |    |    |    |    |    |    |
|    |       |         |    |    |    |    |    |    |    |
|    |       |         |    |    |    |    |    |    |    |
|    |       |         |    |    |    |    |    |    |    |
|    |       |         |    |    |    |    |    |    |    |

|    | dat   | a       |    |    |    |    |    |    |    |
|:---|:------|:--------|:---|:---|:---|:---|:---|:---|:---|
|    | sim   | ulation |    |    |    |    |    |    |    |
|    |       |         |    |    |    |    |    |    |    |
|    |       |         |    |    |    |    |    |    |    |
|    |       |         |    |    |    |    |    |    |    |
|    |       |         |    |    |    |    |    |    |    |
|    |       |         |    |    |    |    |    |    |    |

0.75 distortion (κ 3=0) 0.8 distortion (κ 3=0)
distortion (κ 3≠0) distortion (κ 3≠0)
0.6
0.50
0.4
0.25
0.2
0.00
0.0
−0.25
−0.2
−0.50
−0.4
−0.75
−0.6
−1.00
1 8 1 6 1 8 5 6 1 8 9 6 1 9 3 6 1 9 7 6 2 0 1 6 1 9 2 0 1 9 4 0 1 9 6 0 1 9 8 0 2 0 0 0
Figure 10: (Log-)Price distortion time series for the US stock index (left) and Canadian stock index
(right), for both models considered in this paper (linear and non-linear). Note that the mispricings
are smaller for the non-linear model, as explained in the previous section.
variance of price distortion implied by the linear model (3.7), averaged over all assets,
is equal to 0.233, corresponding to a root-mean-square distortion of 0.5, precisely as
reported in Bouchaud et al. (2017). The non-linear model (4.2) leads to a slightly
smaller variance of 0.215, as expected from the discussion of the previous section.
2000
1600
1750
1400
1500
1200
1250
1000
1000
800
750
600
500 400
250 200
0 0
−4 −3 −2 −1 0 1 2 3 4 −4 −3 −2 −1 0 1 2 3 4
Figure 11: Model-implied histogram of price distortions, averaged over all assets. Left: linear
model (3.3); right: non-linear model (4.1).
In Figure 11 we plot the histogram of price distortions, averaged over all assets,
obtained using the two models considered in this paper. We can see that both of
them lead to a unimodal shape. That means that the market price is most likely to
be near the fundamental value of the asset, albeit with a large dispersion, as noted
above.
However, when restricting to certain assets, such as the US stock index or the
25

|                   |    |    |
|:------------------|:---|:---|
| distortion (κ3=0) |    |    |
| distortion (κ3≠0) |    |    |

|    |    |                   |
|:---|:---|:------------------|
|    |    | distortion (κ3=0) |
|    |    | distortion (κ3≠0) |

| 0                     | 1                     |
|:----------------------|:----------------------|
| 2000                  | 1600                  |
| 1750                  | 1400                  |
| 1500                  | 1200                  |
| 1250                  | 1000                  |
| 1000                  | 800                   |
| 750                   | 600                   |
| 500                   | 400                   |
| 250                   | 200                   |
| 0                     | 0                     |
| −4 −3 −2 −1 0 1 2 3 4 | −4 −3 −2 −1 0 1 2 3 4 |

|    |    |    |    |
|:---|:---|:---|:---|
|    |    |    |    |
|    |    |    |    |
|    |    |    |    |
|    |    |    |    |

|    |    |    |    |
|:---|:---|:---|:---|
|    |    |    |    |
|    |    |    |    |
|    |    |    |    |
|    |    |    |    |
|    |    |    |    |

Canadian stock index, we observe hints of bimodality (see Figure 12). This is a
somewhat intriguing observation since it suggests that the market’s most likely state
is being over-priced or under-priced. This was also recently reported in Schmitt and
Westerhoff (2017).
We statistically confirm the bimodality of mispricing distribution by applying
Silverman (1981) test.9 The null hypothesis of the test is that the investigated distri-
bution has at most k modes, where k is a parameter of the test. The test rejects the
null hypothesis that distribution of mispricing for US equity index has at most one
mode (p-value is 1.5%) while the null hypothesis of the distribution having at most
two modes cannot be rejected (p-value is 60.4%). We receive similar results for the
distribution of mispricing of Canadian stock index - p-value equals 0.1% for null hy-
pothesis of at most one mode and p-value equals 90.6% for null hypothesis of at most
two modes. Consequently, at 5% significance level we reject the hypothesis that both
empirical distribution plotted on Figure 12 have one mode and we cannot reject the
hypothesis that they have at most two modes, which suggests that the distributions
of mispricing of US and Canadian index are bimodal.
50
140
120 40
100
30
80
60 20
40
10
20
0 0
−1.0 −0.8 −0.6 −0.4 −0.2 0.0 0.2 0.4 0.6 −0.6 −0.4 −0.2 0.0 0.2 0.4 0.6
Figure 12: Histogram of the price distortion for US stock index (left) and Canadian stock index
(right), using the non-linear model (4.1).
Note that the stochastic dynamic systems described by (3.3) or (4.1) indeed
undergo a phenomenological bifurcation (P-bifurcation) in parameter space, which
means a qualitative change in the stationary distribution of mispricing from uni-
modal to bimodal. Since the Fokker-Planck equation associated with those systems
does not have a known solution, one has to use approximation methods to find the set
of parameters for which the bifurcation occurs. The result of the analysis of Chiarella
et al. (2008) and Chiarella et al. (2011) is the following condition for P-bifurcation:
9We apply the R package silvermantest, which is an implementation of Silverman (1981) test
taking into account modification suggested by Hall and York (2001) in order to prevent it from being
too conservative.
26

|    |    |    |    |
|:---|:---|:---|:---|
|    |    |    |    |
|    |    |    |    |
|    |    |    |    |

|    |    |    |
|:---|:---|:---|
|    |    |    |
|    |    |    |
|    |    |    |

when α+κ−αγβ < 0 the stationary distribution of (δ ,M ) has a crater shape, other-
t t
wise it has a single peak. Observe that it is the same condition as for the existence of
limit cycles in the deterministic case (see Section 3.2). The crater shape distribution
of the two-dimensional system corresponds to a bimodal distribution of mispricings.10
In Figure 13 we plot the histogram of simulated price distortion distribution for both
models. Since α + κ − αγβ > 0 for all assets, we observe a unimodal distribution for
model (3.3). For model (4.1) we observe a bimodal distribution due to negative value
of κ.
40000
25000
35000
30000 20000
25000
15000
20000
15000 10000
10000
5000
5000
0 0
−4 −3 −2 −1 0 1 2 3 4 −3 −2 −1 0 1 2 3
Figure 13: Simulated histogram of price distortion. The left plot correspond to model (3.3) and
the right to model (4.1). We use parameters from Tables 3 and 5.
2500
175
70
2000 150
60
125
50
1500
100
40
1000 75 30
50 20
500
25 10
0 0 0
−4 −3 −2 −1 0 1 2 3 4 −4 −3 −2 −1 0 1 2 3 4 −3 −2 −1 0 1 2 3 4
Figure 14: Distribution of trend signal from the spot prices. On the left: all assets; in the middle:
US index since 1900; on the right: Canadian index.
However, note that for the basic version of the model (3.3), bimodality of mispric-
ing always goes hand in hand with bimodality of the trend signal (see Chiarella et al.
(2008) and Chiarella et al. (2011)). This co-existence of these two bimodalities is not
observed in the data - see Figure 14. The extended model (4.1) does not have this
10The phase diagram of model (4.1) is richer and it has not yet been studied analytically. Obviously
if κ < 0 and κ > 0, then the stationary distribution of mispricing is bimodal, see Bouchaud et al.
3
(2018), Chapter 20.
27

|    |
|:---|
|    |

|    |    |    |    |
|:---|:---|:---|:---|
|    |    |    |    |

| 0   | 1   |
|:----|:----|
|     |     |

|    |    |    |
|:---|:---|:---|
|    |    |    |

|    |    |    |
|:---|:---|:---|
|    |    |    |

16000
25000
14000
20000 12000
10000
15000
8000
10000 6000
4000
5000
2000
0 0
−0.06 −0.04 −0.02 0.00 0.02 0.04 0.06 −0.6 −0.4 −0.2 0.0 0.2 0.4 0.6
Figure 15: Histogram of simulated trend signal (left) and price distortion (right) for model (4.2)
with parameters: κ = 0.0, κ = 0.4, β = 0.03, γ = 50.0, σ = 0.04, σ = 0.02, g = 0.001, v = 5.0.
3 N V 0
limitation. When κ < 0 and κ > 0 (like in the right panel of Figure 13) one clearly
3
finds a bimodal distribution of distortion and a unimodal distribution of trends. But
even if both κ and κ are non-negative we can obtain bimodal distribution of price
3
distortion together with unimodal distribution of trend signal (see Figure 15). This is
another reason for preferring the model with a non-linear demand of fundamentalists.
6 Conclusions
In this paper, we have reconsidered the coexistence of trend and value anomalies in
financial markets from the point of view of Heterogeneous Agent Based Models. The
field is already quite old, with, in particular, seminal papers by Chiarella (1992) and
Lux and Marchesi (1999). Our major contribution is the estimation of a generalized
Chiarella model on four asset classes (equity indices, commodities, FX rates and
government bonds). In particular, our calibration procedure allows us to estimate
the (unobservable) fundamental value of our different assets without having to rely
on an external economic pricing model. In other words, the reference point around
which the market price oscillates is an output of the calibration.
Our extended Chiarella model comes in two versions: one where the fundamental-
ists’ demand function is linear in the mispricing, and one where a non-linear (cubic)
correction is considered. We find that, while capturing most of the phenomenology
of the price dynamics, the linear model fails on several (related) counts: i) the lin-
ear model is not self-consistent as a clear non-linearity of the fundamental demand
remains after calibration; ii) the fundamental value extracted from the linear model
appears not to track closely enough the market price, a discrepancy partially corrected
by a non-linear demand (although the variance of the mispricing is still large and com-
patible with Black’s factor 2); iii) the distribution of mispricings is bimodal for some
28

|    |    |    |    |
|:---|:---|:---|:---|
|    |    |    |    |
|    |    |    |    |
|    |    |    |    |

|    |    |    |    |
|:---|:---|:---|:---|
|    |    |    |    |
|    |    |    |    |
|    |    |    |    |

assets, as recently pointed out by Schmitt and Westerhoff (2017), while the distri-
bution of trend signals remains unimodal. This feature is impossible to reproduce
within a linear model but can be accommodated within the non-linear model. We
have given several plausible, intuitive arguments for the existence of non-linearities in
the fundamentalists’ demand function, that lead to a bimodality in the distribution
of price distortions. If confirmed by independent research, such bimodality would be
a spectacular stigma of the failure of the efficient market hypothesis, since the most
probable state of affairs would be that assets are either over-valued or under-valued
by the market for long periods of time.
The proposed model offers an intuitive explanation of mechanism producing the
non-monotonic shape of trend effect observed by Bouchaud et al. (2017). When we
control trend effect for value (i.e. we condition price distortion to be zero) the mean-
reversion of trend effect disappears. The interpretation of this result is that large
trend signal goes hand in hand with large mispricing, which enhances the activity
of fundamentalists who are wiping out the profits of trend-followers by taking the
opposite position to trend.
Another noteworthy aspect of our paper concerns the estimation procedure, that is
only slowly getting traction within the ABM literature (see Lux (2017) and Bertschinger
et al. (2018) for other recent contributions). In fact, while the EM algorithm is per-
fectly adapted to calibrate the linear model, we advocate the use of the Unscented
Kalman Filter to estimate its non-linear version.
There are several follow-up research questions that would be well worth investi-
gating. One is to extend the present analysis to single stocks, for which the dynamics
is even more complex; in particular some short term mean-reversion is well known
to take place before trend following effects set in. Second is to extend the Chiarella
model to account for the time-evolution of the relative weight of the different groups
of agents (trend followers, fundamentalists, noise-traders), possibly driven by the rel-
ative performance of these strategies – much in the spirit of Lux (1998); Lux and
Marchesi (1999); Giardina and Bouchaud (2003). Finally, it would be interesting to
investigate different functional shapes for the non-linearity of the fundamentalists’ de-
mand (see e.g. footnote 8), and check the robustness of our conclusions with respect
to different specifications.
From a very practical point of view, our estimation methodology offers a general
and efficient procedure to extract the fundamental value of a financial asset from
price time series. We confirm the observation of Bouchaud et al. (2017) that univer-
sal trend following strategies should be supplemented by universal price-based value
strategies in order to obtain the best investment results. Moreover, we emphasize
the importance of controlling higher order terms in trends and price distortions when
constructing such a combined strategy.
29

References
Andrei, D., Cujean, J., 2017. Information percolation, momentum and reversal. Jour-
nal of Financial Economics 123 (3), 617–645.
Asness, C. S., Moskowitz, T. J., Pedersen, L. H., 2013. Value and momentum every-
where. The Journal of Finance 68 (3), 929–985.
Barberis, N., Shleifer, A., Vishny, R., 1998. A model of investor sentiment. Journal
of Financial Economics 49 (3), 307–343.
Barde, S., 2016. Direct comparison of agent-based models of herding in financial
markets. Journal of Economic Dynamics and Control 73, 329–353.
Barroso, P., Edelen, R. M., Karehnke, P., 2017. Crowding and the Moments of Mo-
mentum. Tech. rep., working paper.
Baum, L. E., Petrie, T., Soules, G., Weiss, N., 1970. A maximization technique
occurring in the statistical analysis of probabilistic functions of Markov chains.
The Annals of Mathematical Statistics 41 (1), 164–171.
Beja, A., Goldman, M. B., 1980. On the dynamic behavior of prices in disequilibrium.
The Journal of Finance 35 (2), 235–248.
Bem, D. J., 1965. An experimental analysis of self-persuasion. Journal of Experimen-
tal Social Psychology 1 (3), 199–218.
Bertschinger, N., Mozzhorin, I., Sinha, S., 2018. Reality-check for econophysics:
Likelihood-based fitting of physics-inspired market models to empirical data. arXiv
preprint arXiv:1803.03861.
Black, F., 1986. Noise. The Journal of Finance 41 (3), 528–543.
Boswijk, H. P., Hommes, C. H., Manzan, S., 2007. Behavioral heterogeneity in stock
prices. Journal of Economic Dynamics and Control 31 (6), 1938–1970.
Bouchaud, J.-P., Bonart, J., Donier, J., Gould, M., 2018. Trades, quotes and prices:
financial markets under the microscope. Cambridge University Press.
Bouchaud, J.-P., Ciliberti, S., Lemperiere, Y., Majewski, A., Seager, P., Sin Ronia,
K., 2017. Black was right: Price is within a factor 2 of Value.
Bouchaud, J.-P., Cont, R., 1998. A Langevin approach to stock market fluctuations
and crashes. The European Physical Journal B-Condensed Matter and Complex
Systems 6 (4), 543–550.
30

Brock, W. A., Hommes, C. H., 1997. A rational route to randomness. Econometrica,
1059–1095.
Brock, W. A., Hommes, C. H., 1998. Heterogeneous beliefs and routes to chaos in a
simple asset pricing model. Journal of Economic dynamics and Control 22 (8-9),
1235–1274.
Campbell, J. Y., Shiller, R. J., 1988. Stock prices, earnings, and expected dividends.
The Journal of Finance 43 (3), 661–676.
Carhart, M. M., 1997. On persistence in mutual fund performance. The Journal of
Finance 52 (1), 57–82.
Challet, D., Marsili, M., Zhang, Y.-C., 2013. Minority games: interacting agents in
financial markets. OUP Catalogue.
Chen, C.-F., 1981. The EM approach to the multiple indicators and multiple causes
model via the estimation of the latent variable. Journal of the American Statistical
Association 76 (375), 704–708.
Chiarella, C., 1992. The dynamics of speculative behaviour. Annals of operations
research 37 (1), 101–123.
Chiarella, C., Dieci, R., Gardini, L., 2002. Speculative behaviour and complex asset
price dynamics: a global analysis. Journal of Economic Behavior & Organization
49 (2), 173–197.
Chiarella, C., Dieci, R., Gardini, L., 2006. Asset price and wealth dynamics in a
financial market with heterogeneous agents. Journal of Economic Dynamics and
Control 30 (9-10), 1755–1786.
Chiarella, C., Dieci, R., He, X., 2009. Heterogeneity, market mechanisms and asset
price dynamics. Handbook of Financial Markets: Dynamics and Evolution.
Chiarella, C., He, X., 2001. Asset price and wealth dynamics under heterogeneous
expectations. Quantitative Finance 1 (5), 509–526.
Chiarella, C., He, X.-Z., Wang, D., Zheng, M., 2008. The stochastic bifurcation be-
haviour of speculative financial markets. Physica A: Statistical Mechanics and its
Applications 387 (15), 3837–3846.
Chiarella, C., He, X.-Z., Zheng, M., 2011. An analysis of the effect of noise in a
heterogeneous agent financial market model. Journal of Economic Dynamics and
Control 35 (1), 148–162.
31

Chiarella, C., He, X.-Z., Zwinkels, R. C., 2014. Heterogeneous expectations in asset
pricing: Empirical evidence from the S&P500. Journal of Economic Behavior &
Organization 105, 1–16.
Daniel, K., Hirshleifer, D., Subrahmanyam, A., 1998. Investor psychology and security
market under-and overreactions. The Journal of Finance 53 (6), 1839–1885.
Dao, T., Nguyen, T., Deremble, C., Lempériere, Y., Bouchaud, J., Potters, M., 2017.
Tail Protection for Long Investors: Trend Convexity at Work. Journal of Investment
Strategies 7 (1), 61–84.
De Bondt, W. F., Thaler, R., 1985. Does the stock market overreact? The Journal of
finance 40 (3), 793–805.
De Long, J. B., Shleifer, A., Summers, L. H., Waldmann, R. J., 1990. Noise trader
risk in financial markets. Journal of Political Economy 98 (4), 703–738.
Dempster, A. P., Laird, N. M., Rubin, D. B., 1977. Maximum likelihood from incom-
plete data via the EM algorithm. Journal of the Royal Statistical Society. Series B
(methodological), 1–38.
Dieci, R., He, X.-Z., 2018. Heterogeneous Agent Models in Finance. In: Cars Hommes
and Blake LeBaron (Ed.), Handbook of Computational Economics. Vol. 4. Elsevier,
pp. 257 – 328.
Durbin, J., Koopman, S. J., 2012. Time Series Analysis by State Space Methods.
Vol. 38. Oxford University Press.
Edwards, W., 1968. Conservatism in human information processing. In: Kleinmutz,
B. (Ed.), Formal Representation of Human Judgment. John Wiley and Sons, New
York.
Fama, E. F., French, K. R., 1992. The cross-section of expected stock returns. the
Journal of Finance 47 (2), 427–465.
Fama, E. F., French, K. R., 2012. Size, value, and momentum in international stock
returns. Journal of Financial Economics 105 (3), 457–472.
Fama, E. F., French, K. R., 2016. Dissecting anomalies with a five-factor model. The
Review of Financial Studies 29 (1), 69–103.
Franke, R., Westerhoff, F., 2011. Estimation of a structural stochastic volatility model
of asset pricing. Computational Economics 38 (1), 53–83.
32

Franke, R., Westerhoff, F., 2016. Why a simple herding model may generate the
stylized facts of daily returns: explanation and estimation. Journal of Economic
Interaction and Coordination 11 (1), 1–34.
Ghonghadze, J., Lux, T., 2016. Bringing an elementary agent-based model to the
data: Estimation via GMM and an application to forecasting of asset price volatil-
ity. Journal of Empirical Finance 37, 1–19.
Giardina, I., Bouchaud, J.-P., 2003. Bubbles, crashes and intermittency in agent based
market models. The European Physical Journal B-Condensed Matter and Complex
Systems 31 (3), 421–437.
Gordon, M. J., 1962. The Investment, Financing, and Valuation of the Corporation.
Homewood, Illinois: Richard D. Irwin, Inc.
Graham, B., Dodd, D. L., 1934. Security analysis. McGraw Hill Inc, New York.
Griffin, J. M., Ji, X., Martin, J. S., 2003. Momentum investing and business cycle
risk: Evidence from pole to pole. The Journal of Finance 58 (6), 2515–2547.
Hall, P., York, M., 2001. On the calibration of Silverman’s test for multimodality.
Statistica Sinica, 515–536.
Hommes, C., LeBaron, B. (Eds.), 2018. Heterogeneous Agent Modeling. Handbook
of Computational Economics. Elsevier Science.
Hommes, C. H., 2006. Heterogeneous agent models in economics and finance. Hand-
book of Computational Economics 2, 1109–1186.
Hong, H., Stein, J. C., 1999. A unified theory of underreaction, momentum trading,
and overreaction in asset markets. The Journal of Finance 54 (6), 2143–2184.
Ide, K., Sornette, D., 2002. Oscillatory finite-time singularities in finance, population
and rupture. Physica A: Statistical Mechanics and its Applications 307 (1-2), 63–
106.
Jegadeesh, N., 1990. Evidence of predictable behavior of security returns. The Journal
of Finance 45 (3), 881–898.
Jegadeesh, N., Titman, S., 1993. Returns to buying winners and selling losers: Im-
plications for stock market efficiency. The Journal of Finance 48 (1), 65–91.
Julier, S. J., Uhlmann, J. K., 1997. New extension of the Kalman filter to nonlinear
systems. In: Signal processing, sensor fusion, and target recognition VI. Vol. 3068.
International Society for Optics and Photonics, pp. 182–194.
33

Kahneman, D., 2011. Thinking Fast and Slow. Penguin.
Kahneman, D., Tversky, A., 1973. On the psychology of prediction. Psychological
Review 80 (4), 237.
Kalman, R. E., 1960. A new approach to linear filtering and prediction problems.
Journal of Basic Engineering 82 (1), 35–45.
Kokkala, J., Solin, A., Särkkä, S., 2014. Expectation maximization based parameter
estimation by sigma-point and particle smoothing. In: 17th International Confer-
ence on Information Fusion 2014. IEEE, pp. 1–8.
Kokkala, J., Solin, A., Särkkä, S., 2015. Sigma-point filtering and smoothing based
parameter estimation in nonlinear dynamic systems. Submitted to Journal of Ad-
vances in Information Fusion.
Kyle, A. S., 1985. Continuous auctions and insider trading. Econometrica: Journal
of the Econometric Society, 1315–1335.
Lakonishok, J., Shleifer, A., Vishny, R. W., 1994. Contrarian investment, extrapola-
tion, and risk. The Journal of Finance 49 (5), 1541–1578.
Lamperti, F., Roventini, A., Sani, A., 2017. Agent-based model calibration using
machine learning surrogates. arXiv preprint arXiv:1803.03861.
Landier, A., Ma, Y., Thesmar, D., 2017. New Experimental Evidence on Expectations
Formation. Available at SSRN: https://ssrn.com/abstract=3046955.
LeBaron, B., 2006. Agent-based computational finance. Handbook of Computational
Economics 2, 1187–1233.
LeBaron, B., Arthur, W. B., Palmer, R., 1999. Time series properties of an artificial
stock market. Journal of Economic Dynamics and control 23 (9-10), 1487–1516.
Lehmann, B. N., 1990. Fads, martingales, and market efficiency. The Quarterly Jour-
nal of Economics 105 (1), 1–28.
Lempérière, Y., Deremble, C., Nguyen, T.-T., Seager, P., Potters, M., Bouchaud,
J.-P., 2017. Risk premia: Asymmetric tail risks and excess returns. Quantitative
Finance 17 (1), 1–14.
Lempérière, Y., Deremble, C., Seager, P., Potters, M., Bouchaud, J.-P., 2014. Two
centuries of trend following. Risk 3 (3), 41–61.
34

Liu, L. X., Zhang, L., 2008. Momentum profits, factor pricing, and macroeconomic
risk. The Review of Financial Studies 21 (6), 2417–2448.
Lux, T., 1998. The socio-economic dynamics of speculative markets: interacting
agents, chaos, and the fat tails of return distributions. Journal of Economic Be-
havior & Organization 33 (2), 143–165.
Lux, T., 2017. Estimation of agent-based models using sequential Monte Carlo meth-
ods. Tech. rep., Economics Working Paper.
Lux, T., Marchesi, M., 1999. Scaling and criticality in a stochastic multi-agent model
of a financial market. Nature 397 (6719), 498.
Moskowitz, T. J., Ooi, Y. H., Pedersen, L. H., 2012. Time series momentum. Journal
of Financial Economics 104 (2), 228–250.
Pástor, L., Stambaugh, R. F., 2003. Liquidity risk and expected stock returns. Journal
of Political Economy 111 (3), 642–685.
Rosenberg, B., Reid, K., Lanstein, R., 1985. Persuasive evidence of market ineffi-
ciency. The Journal of Portfolio Management 11 (3), 9–16.
Roweis, S., Ghahramani, Z., 2001. Learning nonlinear dynamical systems using the
expectation–maximization algorithm. Chapter in book: ’Kalman filtering and neu-
ral networks’ edited by Simon Haykin, 175–220.
Sadka, R., 2006. Momentum and post-earnings-announcement drift anomalies: The
role of liquidity risk. Journal of Financial Economics 80 (2), 309–349.
Särkkä, S., 2013. Bayesian filtering and smoothing. Vol. 3. Cambridge University
Press.
Schmitt, N., Westerhoff, F., 2017. On the bimodality of the distribution of the S&P
500’s distortion: Empirical evidence and theoretical explanations. Journal of Eco-
nomic Dynamics and Control 80, 34–53.
Shiller, R. J., 1980. Do stock prices move too much to be justified by subsequent
changes in dividends? National Bureau of Economic Research Cambridge, Mass.,
USA.
Shiller, R. J., 1987. Investor behavior in the October 1987 stock market crash: Survey
evidence. NBER working paper No. 2446, November 1987, published in Shiller, R.J.,
Market Volatility, MIT Press, Cambridge, 198, chapter 23.
35

Shiller, R. J., 2000. Irrational exuberance. Princeton University Press.
Shumway, R. H., Stoffer, D. S., 1982. An approach to time series smoothing and
forecasting using the EM algorithm. Journal of time series analysis 3 (4), 253–264.
Silverman, B. W., 1981. Using kernel density estimates to investigate multimodality.
Journal of the Royal Statistical Society. Series B (Methodological), 97–99.
Summers, L. H., 1986. Does the stock market rationally reflect fundamental values?
The Journal of Finance 41 (3), 591–601.
Thaler, R. H. (Ed.), 1993. Advances in Behavioral Finance. Russell Sage Foundation.
Thaler, R. H. (Ed.), 2005. Advances in Behavioral Finance. Volume 2. Princeton
University Press.
Tversky, A., Kahneman, D., 1974. Judgment under Uncertainty: Heuristics and Bi-
ases. Science 185 (4157), 1124–1131.
Vayanos, D., Woolley, P., 2013. An institutional theory of momentum and reversal.
The Review of Financial Studies 26 (5), 1087–1145.
Wyart, M., Bouchaud, J.-P., 2007. Self-referential behaviour, overreaction and con-
ventions in financial markets. Journal of Economic Behavior & Organization 63 (1),
1–24.
36

A Estimation results
κ β γ σ σ g v L
N V 0
US 0.015 0.015 36.7 0.043 0.018 0.0011 4.42 4596.4
UK 0.015 0.015 40.9 0.036 0.018 0.0013 6.85 4920.7
AU 0.015 0.015 40.8 0.039 0.018 0.0016 5.97 3053.9
CH 0.015 0.015 32.6 0.044 0.018 0.0019 3.89 2037.9
JP 0.015 0.015 25.1 0.059 0.018 0.0029 7.24 1611.7
CA 0.015 0.015 34.5 0.045 0.018 0.0017 7.48 2011.1
DE 0.015 0.015 32.2 0.044 0.018 0.0023 30.59 2481.2
SUGAR 0.094 0.020 24.1 0.074 0.036 -0.0007 6.43 2945.0
CORN 0.094 0.020 19.6 0.118 0.036 -0.0008 2.75 1223.5
LCATTLE 0.094 0.020 33.7 0.062 0.036 0.0002 4.89 2363.3
WHEAT 0.094 0.020 23.3 0.092 0.036 -0.0009 3.28 1856.6
COPPER 0.094 0.020 30.6 0.062 0.036 -0.0004 7.47 3317.9
NATGAS 0.094 0.020 14.8 0.182 0.036 0.0014 1.09 83.4
CRUDE 0.094 0.020 14.1 0.109 0.036 -0.0005 3.98 1011.6
CHFUSD 0.017 0.005 49.5 0.034 0.010 0.0019 -0.84 965.9
JPYUSD 0.017 0.005 50.1 0.032 0.010 0.0022 -1.07 998.5
AUDUSD 0.017 0.005 54.2 0.033 0.010 0.0001 -0.25 990.5
GBPUSD 0.017 0.005 56.7 0.029 0.010 -0.0005 0.68 1051.4
CADUSD 0.017 0.005 96.6 0.019 0.010 0.0013 -0.60 1251.7
EURUSD 0.017 0.005 51.1 0.032 0.010 0.0010 -0.21 1005.8
USBND 0.086 0.013 39.3 0.045 0.041 -0.0006 1.43 1826.7
UKBND 0.086 0.013 37.0 0.049 0.041 -0.0015 2.01 1073.1
CHBND 0.086 0.013 31.1 0.052 0.041 -0.0017 1.63 1715.9
JPBND 0.086 0.013 24.5 0.087 0.041 -0.0075 2.20 419.8
AUBND 0.086 0.013 38.5 0.044 0.041 -0.0040 2.64 623.1
CABND 0.086 0.013 47.7 0.036 0.041 -0.0008 1.64 2103.8
DEBND 0.086 0.013 35.1 0.046 0.041 -0.0020 1.79 1251.7
Table 3: Estimation results for model (3.7). Predictive log-likelihood L is calculated according
to (B.22). CRUDE stands for crude oil, NATGAS for Henry Hub natural gas, LCATTLE for live
cattle and abbreviation BND stands for government bonds.
37

| 0   |     1 |     2 |    3 |     4 |     5 |      6 |    7 |      8 |
|:----|------:|------:|-----:|------:|------:|-------:|-----:|-------:|
| US  | 0.015 | 0.015 | 36.7 | 0.043 | 0.018 | 0.0011 | 4.42 | 4596.4 |

| 0   |     1 |     2 |    3 |     4 |     5 |      6 |    7 |      8 |
|:----|------:|------:|-----:|------:|------:|-------:|-----:|-------:|
| AU  | 0.015 | 0.015 | 40.8 | 0.039 | 0.018 | 0.0016 | 5.97 | 3053.9 |

| 0   |     1 |     2 |    3 |     4 |     5 |      6 |    7 |      8 |
|:----|------:|------:|-----:|------:|------:|-------:|-----:|-------:|
| JP  | 0.015 | 0.015 | 25.1 | 0.059 | 0.018 | 0.0029 | 7.24 | 1611.7 |

| 0   |     1 |     2 |    3 |     4 |     5 |      6 |     7 |      8 |
|:----|------:|------:|-----:|------:|------:|-------:|------:|-------:|
| DE  | 0.015 | 0.015 | 32.2 | 0.044 | 0.018 | 0.0023 | 30.59 | 2481.2 |

| 0    |     1 |    2 |    3 |     4 |     5 |       6 |    7 |      8 |
|:-----|------:|-----:|-----:|------:|------:|--------:|-----:|-------:|
| CORN | 0.094 | 0.02 | 19.6 | 0.118 | 0.036 | -0.0008 | 2.75 | 1223.5 |

| 0     |     1 |    2 |    3 |     4 |     5 |       6 |    7 |      8 |
|:------|------:|-----:|-----:|------:|------:|--------:|-----:|-------:|
| WHEAT | 0.094 | 0.02 | 23.3 | 0.092 | 0.036 | -0.0009 | 3.28 | 1856.6 |

| 0      |     1 |    2 |    3 |     4 |     5 |      6 |    7 |    8 |
|:-------|------:|-----:|-----:|------:|------:|-------:|-----:|-----:|
| NATGAS | 0.094 | 0.02 | 14.8 | 0.182 | 0.036 | 0.0014 | 1.09 | 83.4 |

| 0      |     1 |     2 |    3 |     4 |    5 |      6 |     7 |     8 |
|:-------|------:|------:|-----:|------:|-----:|-------:|------:|------:|
| CHFUSD | 0.017 | 0.005 | 49.5 | 0.034 | 0.01 | 0.0019 | -0.84 | 965.9 |

| 0      |     1 |     2 |    3 |     4 |    5 |      6 |     7 |     8 |
|:-------|------:|------:|-----:|------:|-----:|-------:|------:|------:|
| AUDUSD | 0.017 | 0.005 | 54.2 | 0.033 | 0.01 | 0.0001 | -0.25 | 990.5 |

| 0      |     1 |     2 |    3 |     4 |    5 |      6 |    7 |      8 |
|:-------|------:|------:|-----:|------:|-----:|-------:|-----:|-------:|
| CADUSD | 0.017 | 0.005 | 96.6 | 0.019 | 0.01 | 0.0013 | -0.6 | 1251.7 |

| 0     |     1 |     2 |    3 |     4 |     5 |       6 |    7 |      8 |
|:------|------:|------:|-----:|------:|------:|--------:|-----:|-------:|
| USBND | 0.086 | 0.013 | 39.3 | 0.045 | 0.041 | -0.0006 | 1.43 | 1826.7 |

| 0     |     1 |     2 |    3 |     4 |     5 |       6 |    7 |      8 |
|:------|------:|------:|-----:|------:|------:|--------:|-----:|-------:|
| CHBND | 0.086 | 0.013 | 31.1 | 0.052 | 0.041 | -0.0017 | 1.63 | 1715.9 |

| 0     |     1 |     2 |    3 |     4 |     5 |      6 |    7 |     8 |
|:------|------:|------:|-----:|------:|------:|-------:|-----:|------:|
| AUBND | 0.086 | 0.013 | 38.5 | 0.044 | 0.041 | -0.004 | 2.64 | 623.1 |

| 0     |     1 |     2 |    3 |     4 |     5 |      6 |    7 |      8 |
|:------|------:|------:|-----:|------:|------:|-------:|-----:|-------:|
| DEBND | 0.086 | 0.013 | 35.1 | 0.046 | 0.041 | -0.002 | 1.79 | 1251.7 |

κ β σ σ g v
N V 0
US 4.459505 11.625 29.887 4.326 2.680 28.941
UK 4.459505 11.625 19.069 4.326 2.797 28.488
AU 4.459505 11.625 15.048 4.326 3.343 19.358
CH 4.459505 11.625 25.885 4.326 3.286 14.578
JP 4.459505 11.625 24.601 4.326 3.547 18.005
CA 4.459505 11.625 25.887 4.326 4.576 64.456
DE 4.459505 11.625 29.294 4.326 2.949 88.349
SUGAR 3.820824 4.379 30.009 7.957 -1.732 32.308
CORN 3.820824 4.379 7.187 7.957 -2.359 5.760
LCATTLE 3.820824 4.379 26.617 7.957 0.851 19.140
WHEAT 3.820824 4.379 34.577 7.957 -2.326 15.100
COPPER 3.820824 4.379 21.711 7.957 -0.624 31.440
NATGAS 3.820824 4.379 15.185 7.957 0.816 10.706
CRUDE 3.820824 4.379 23.448 7.957 -0.665 7.889
CHFUSD 3.747808 3.489 25.357 1.164 1.893 -3.930
JPYUSD 3.747808 3.489 24.584 1.164 2.222 -6.619
AUDUSD 3.747808 3.489 16.985 1.164 0.577 -0.798
GBPUSD 3.747808 3.489 22.620 1.164 -0.398 4.177
CADUSD 3.747808 3.489 15.658 1.164 0.531 -1.336
EURUSD 3.747808 3.489 26.910 1.164 0.935 -1.184
USBND 1.053739 1.212 19.007 2.115 -0.650 14.424
UKBND 1.053739 1.212 20.205 2.115 -2.926 27.845
CHBND 1.053739 1.212 13.438 2.115 -3.098 19.675
JPBND 1.053739 1.212 12.280 2.115 -3.321 11.560
AUBND 1.053739 1.212 17.907 2.115 -3.316 36.021
CABND 1.053739 1.212 23.731 2.115 -1.517 23.660
DEBND 1.053739 1.212 17.644 2.115 -3.143 21.471
Table 4: T-statistics of estimation for model (3.7). CRUDE stands for crude oil, NATGAS for
Henry Hub natural gas, LCATTLE for live cattle and abbreviation BND stands for government
bonds.
38

| 0   |       1 |      2 |      3 |     4 |    5 |      6 |
|:----|--------:|-------:|-------:|------:|-----:|-------:|
| US  | 4.45951 | 11.625 | 29.887 | 4.326 | 2.68 | 28.941 |

| 0   |       1 |      2 |      3 |     4 |     5 |      6 |
|:----|--------:|-------:|-------:|------:|------:|-------:|
| AU  | 4.45951 | 11.625 | 15.048 | 4.326 | 3.343 | 19.358 |

| 0   |       1 |      2 |      3 |     4 |     5 |      6 |
|:----|--------:|-------:|-------:|------:|------:|-------:|
| JP  | 4.45951 | 11.625 | 24.601 | 4.326 | 3.547 | 18.005 |

| 0   |       1 |      2 |      3 |     4 |     5 |      6 |
|:----|--------:|-------:|-------:|------:|------:|-------:|
| DE  | 4.45951 | 11.625 | 29.294 | 4.326 | 2.949 | 88.349 |

| 0    |       1 |     2 |     3 |     4 |      5 |    6 |
|:-----|--------:|------:|------:|------:|-------:|-----:|
| CORN | 3.82082 | 4.379 | 7.187 | 7.957 | -2.359 | 5.76 |

| 0     |       1 |     2 |      3 |     4 |      5 |    6 |
|:------|--------:|------:|-------:|------:|-------:|-----:|
| WHEAT | 3.82082 | 4.379 | 34.577 | 7.957 | -2.326 | 15.1 |

| 0      |       1 |     2 |      3 |     4 |     5 |      6 |
|:-------|--------:|------:|-------:|------:|------:|-------:|
| NATGAS | 3.82082 | 4.379 | 15.185 | 7.957 | 0.816 | 10.706 |

| 0      |       1 |     2 |      3 |     4 |     5 |     6 |
|:-------|--------:|------:|-------:|------:|------:|------:|
| CHFUSD | 3.74781 | 3.489 | 25.357 | 1.164 | 1.893 | -3.93 |

| 0      |       1 |     2 |      3 |     4 |     5 |      6 |
|:-------|--------:|------:|-------:|------:|------:|-------:|
| AUDUSD | 3.74781 | 3.489 | 16.985 | 1.164 | 0.577 | -0.798 |

| 0      |       1 |     2 |      3 |     4 |     5 |      6 |
|:-------|--------:|------:|-------:|------:|------:|-------:|
| CADUSD | 3.74781 | 3.489 | 15.658 | 1.164 | 0.531 | -1.336 |

| 0     |       1 |     2 |      3 |     4 |     5 |      6 |
|:------|--------:|------:|-------:|------:|------:|-------:|
| USBND | 1.05374 | 1.212 | 19.007 | 2.115 | -0.65 | 14.424 |

| 0     |       1 |     2 |      3 |     4 |      5 |      6 |
|:------|--------:|------:|-------:|------:|-------:|-------:|
| CHBND | 1.05374 | 1.212 | 13.438 | 2.115 | -3.098 | 19.675 |

| 0     |       1 |     2 |      3 |     4 |      5 |      6 |
|:------|--------:|------:|-------:|------:|-------:|-------:|
| AUBND | 1.05374 | 1.212 | 17.907 | 2.115 | -3.316 | 36.021 |

| 0     |       1 |     2 |      3 |     4 |      5 |      6 |
|:------|--------:|------:|-------:|------:|-------:|-------:|
| DEBND | 1.05374 | 1.212 | 17.644 | 2.115 | -3.143 | 21.471 |

ˆ
κ κ β γ σ σ g v L
3 N V 0
US -0.011 0.269 0.018 36.7 0.042 0.018 0.0011 4.41 4616.8
UK -0.011 0.269 0.018 40.9 0.034 0.018 0.0010 7.12 4932.8
AU -0.011 0.269 0.018 40.8 0.031 0.018 0.0014 5.71 2987.9
CH -0.011 0.269 0.018 32.6 0.043 0.018 0.0013 4.29 2019.6
JP -0.011 0.269 0.018 25.1 0.057 0.018 0.0024 7.94 1605.6
CA -0.011 0.269 0.018 34.5 0.045 0.018 0.0015 7.54 2016.6
DE -0.011 0.269 0.018 32.2 0.041 0.018 0.0023 31.03 2477.6
SUGAR -0.065 0.536 0.011 24.1 0.074 0.036 -0.0013 6.69 2949.7
CORN -0.065 0.536 0.011 19.6 0.105 0.036 -0.0010 2.84 1425.1
LCATTLE -0.065 0.536 0.011 33.7 0.061 0.036 0.0000 5.16 2385.7
WHEAT -0.065 0.536 0.011 23.3 0.090 0.036 -0.0012 3.17 1887.7
COPPER -0.065 0.536 0.011 30.6 0.057 0.036 -0.0003 7.05 3370.6
NATGAS -0.065 0.536 0.011 14.8 0.167 0.036 0.0018 0.99 102.8
CRUDE -0.065 0.536 0.011 14.1 0.085 0.036 -0.0014 25.67 813.9
CHFUSD -0.019 0.581 0.006 49.5 0.034 0.010 0.0020 -1.27 962.7
JPYUSD -0.019 0.581 0.006 50.1 0.032 0.010 0.0020 -1.10 996.7
AUDUSD -0.019 0.581 0.006 54.2 0.029 0.010 -0.0002 0.34 979.2
GBPUSD -0.019 0.581 0.006 56.7 0.026 0.010 -0.0010 0.76 1045.0
CADUSD -0.019 0.581 0.006 96.6 0.019 0.010 -0.0002 -0.02 1256.6
EURUSD -0.019 0.581 0.006 51.1 0.030 0.010 0.0015 -0.55 1004.7
USBND -0.179 7.435 0.016 39.3 0.042 0.041 0.0004 1.26 1874.8
UKBND -0.179 7.435 0.016 37.0 0.048 0.041 -0.0014 2.00 1074.2
CHBND -0.179 7.435 0.016 31.1 0.050 0.041 -0.0018 1.67 1758.0
JPBND -0.179 7.435 0.016 24.5 0.083 0.041 -0.0082 2.35 399.2
AUBND -0.179 7.435 0.016 38.5 0.042 0.041 -0.0017 2.66 628.4
CABND -0.179 7.435 0.016 47.7 0.033 0.041 0.0001 1.59 2134.6
DEBND -0.179 7.435 0.016 35.1 0.045 0.041 -0.0016 1.69 1280.9
Table 5: Estimation results for model (4.2). Predictive log-likelihood Lˆ is calculated according to
(C.1). CRUDE stands for crude oil, NATGAS for Henry Hub natural gas, LCATTLE for live cattle
and abbreviation BND stands for government bonds.
39

| 0   |      1 |     2 |     3 |    4 |     5 |     6 |      7 |    8 |      9 |
|:----|-------:|------:|------:|-----:|------:|------:|-------:|-----:|-------:|
| US  | -0.011 | 0.269 | 0.018 | 36.7 | 0.042 | 0.018 | 0.0011 | 4.41 | 4616.8 |

| 0   |      1 |     2 |     3 |    4 |     5 |     6 |      7 |    8 |      9 |
|:----|-------:|------:|------:|-----:|------:|------:|-------:|-----:|-------:|
| AU  | -0.011 | 0.269 | 0.018 | 40.8 | 0.031 | 0.018 | 0.0014 | 5.71 | 2987.9 |

| 0   |      1 |     2 |     3 |    4 |     5 |     6 |      7 |    8 |      9 |
|:----|-------:|------:|------:|-----:|------:|------:|-------:|-----:|-------:|
| JP  | -0.011 | 0.269 | 0.018 | 25.1 | 0.057 | 0.018 | 0.0024 | 7.94 | 1605.6 |

| 0   |      1 |     2 |     3 |    4 |     5 |     6 |      7 |     8 |      9 |
|:----|-------:|------:|------:|-----:|------:|------:|-------:|------:|-------:|
| DE  | -0.011 | 0.269 | 0.018 | 32.2 | 0.041 | 0.018 | 0.0023 | 31.03 | 2477.6 |

| 0    |      1 |     2 |     3 |    4 |     5 |     6 |      7 |    8 |      9 |
|:-----|-------:|------:|------:|-----:|------:|------:|-------:|-----:|-------:|
| CORN | -0.065 | 0.536 | 0.011 | 19.6 | 0.105 | 0.036 | -0.001 | 2.84 | 1425.1 |

| 0     |      1 |     2 |     3 |    4 |    5 |     6 |       7 |    8 |      9 |
|:------|-------:|------:|------:|-----:|-----:|------:|--------:|-----:|-------:|
| WHEAT | -0.065 | 0.536 | 0.011 | 23.3 | 0.09 | 0.036 | -0.0012 | 3.17 | 1887.7 |

| 0      |      1 |     2 |     3 |    4 |     5 |     6 |      7 |    8 |     9 |
|:-------|-------:|------:|------:|-----:|------:|------:|-------:|-----:|------:|
| NATGAS | -0.065 | 0.536 | 0.011 | 14.8 | 0.167 | 0.036 | 0.0018 | 0.99 | 102.8 |

| 0      |      1 |     2 |     3 |    4 |     5 |    6 |     7 |     8 |     9 |
|:-------|-------:|------:|------:|-----:|------:|-----:|------:|------:|------:|
| CHFUSD | -0.019 | 0.581 | 0.006 | 49.5 | 0.034 | 0.01 | 0.002 | -1.27 | 962.7 |

| 0      |      1 |     2 |     3 |    4 |     5 |    6 |       7 |    8 |     9 |
|:-------|-------:|------:|------:|-----:|------:|-----:|--------:|-----:|------:|
| AUDUSD | -0.019 | 0.581 | 0.006 | 54.2 | 0.029 | 0.01 | -0.0002 | 0.34 | 979.2 |

| 0      |      1 |     2 |     3 |    4 |     5 |    6 |       7 |     8 |      9 |
|:-------|-------:|------:|------:|-----:|------:|-----:|--------:|------:|-------:|
| CADUSD | -0.019 | 0.581 | 0.006 | 96.6 | 0.019 | 0.01 | -0.0002 | -0.02 | 1256.6 |

| 0     |      1 |     2 |     3 |    4 |     5 |     6 |      7 |    8 |      9 |
|:------|-------:|------:|------:|-----:|------:|------:|-------:|-----:|-------:|
| USBND | -0.179 | 7.435 | 0.016 | 39.3 | 0.042 | 0.041 | 0.0004 | 1.26 | 1874.8 |

| 0     |      1 |     2 |     3 |    4 |    5 |     6 |       7 |    8 |    9 |
|:------|-------:|------:|------:|-----:|-----:|------:|--------:|-----:|-----:|
| CHBND | -0.179 | 7.435 | 0.016 | 31.1 | 0.05 | 0.041 | -0.0018 | 1.67 | 1758 |

| 0     |      1 |     2 |     3 |    4 |     5 |     6 |       7 |    8 |     9 |
|:------|-------:|------:|------:|-----:|------:|------:|--------:|-----:|------:|
| AUBND | -0.179 | 7.435 | 0.016 | 38.5 | 0.042 | 0.041 | -0.0017 | 2.66 | 628.4 |

| 0     |      1 |     2 |     3 |    4 |     5 |     6 |       7 |    8 |      9 |
|:------|-------:|------:|------:|-----:|------:|------:|--------:|-----:|-------:|
| DEBND | -0.179 | 7.435 | 0.016 | 35.1 | 0.045 | 0.041 | -0.0016 | 1.69 | 1280.9 |

κ κ β σ g v
3 N 0
US -2.289 2.150 8.705 27.377 5.270 76.319
UK -2.289 2.150 8.705 23.777 8.154 119.690
AU -2.289 2.150 8.705 27.986 3.411 572.320
CH -2.289 2.150 8.705 25.522 4.158 31.903
JP -2.289 2.150 8.705 21.722 4.362 29.014
CA -2.289 2.150 8.705 25.358 2.123 129.614
DE -2.289 2.150 8.705 24.464 4.721 319.856
SUGAR -4.979 3.974 2.553 31.107 -2.945 4.577
CORN -4.979 3.974 2.553 11.510 -1.062 46.322
LCATTLE -4.979 3.974 2.553 27.246 1.547 39.852
WHEAT -4.979 3.974 2.553 35.770 -2.630 20.007
COPPER -4.979 3.974 2.553 17.763 -1.561 117.953
NATGAS -4.979 3.974 2.553 15.579 1.545 7.006
CRUDE -4.979 3.974 2.553 12.699 -1.645 93.434
CHFUSD -1.386 1.369 3.418 24.778 3.873 -6.969
JPYUSD -1.386 1.369 3.418 15.195 1.823 -2.970
AUDUSD -1.386 1.369 3.418 12.293 -0.647 10.738
GBPUSD -1.386 1.369 3.418 13.911 -1.975 22.620
CADUSD -1.386 1.369 3.418 16.546 -0.407 -0.138
EURUSD -1.386 1.369 3.418 22.244 8.167 -8.277
USBND -9.591 17.931 13.270 21.581 2.524 34.161
UKBND -9.591 17.931 13.270 19.833 -2.111 69.679
CHBND -9.591 17.931 13.270 14.253 -3.006 18.736
JPBND -9.591 17.931 13.270 9.380 -1.336 1.791
AUBND -9.591 17.931 13.270 17.134 -3.410 88.784
CABND -9.591 17.931 13.270 29.540 1.124 323.950
DEBND -9.591 17.931 13.270 19.062 -4.249 94.968
Table 6: T-statistics of estimation for model (4.2). CRUDE stands for crude oil, NATGAS for
Henry Hub natural gas, LCATTLE for live cattle and abbreviation BND stands for government
bonds.
40

| 0   |      1 |    2 |     3 |      4 |    5 |      6 |
|:----|-------:|-----:|------:|-------:|-----:|-------:|
| US  | -2.289 | 2.15 | 8.705 | 27.377 | 5.27 | 76.319 |

| 0   |      1 |    2 |     3 |      4 |     5 |      6 |
|:----|-------:|-----:|------:|-------:|------:|-------:|
| AU  | -2.289 | 2.15 | 8.705 | 27.986 | 3.411 | 572.32 |

| 0   |      1 |    2 |     3 |      4 |     5 |      6 |
|:----|-------:|-----:|------:|-------:|------:|-------:|
| JP  | -2.289 | 2.15 | 8.705 | 21.722 | 4.362 | 29.014 |

| 0   |      1 |    2 |     3 |      4 |     5 |       6 |
|:----|-------:|-----:|------:|-------:|------:|--------:|
| DE  | -2.289 | 2.15 | 8.705 | 24.464 | 4.721 | 319.856 |

| 0    |      1 |     2 |     3 |     4 |      5 |      6 |
|:-----|-------:|------:|------:|------:|-------:|-------:|
| CORN | -4.979 | 3.974 | 2.553 | 11.51 | -1.062 | 46.322 |

| 0     |      1 |     2 |     3 |     4 |     5 |      6 |
|:------|-------:|------:|------:|------:|------:|-------:|
| WHEAT | -4.979 | 3.974 | 2.553 | 35.77 | -2.63 | 20.007 |

| 0      |      1 |     2 |     3 |      4 |     5 |     6 |
|:-------|-------:|------:|------:|-------:|------:|------:|
| NATGAS | -4.979 | 3.974 | 2.553 | 15.579 | 1.545 | 7.006 |

| 0      |      1 |     2 |     3 |      4 |     5 |      6 |
|:-------|-------:|------:|------:|-------:|------:|-------:|
| CHFUSD | -1.386 | 1.369 | 3.418 | 24.778 | 3.873 | -6.969 |

| 0      |      1 |     2 |     3 |      4 |      5 |      6 |
|:-------|-------:|------:|------:|-------:|-------:|-------:|
| AUDUSD | -1.386 | 1.369 | 3.418 | 12.293 | -0.647 | 10.738 |

| 0      |      1 |     2 |     3 |      4 |      5 |      6 |
|:-------|-------:|------:|------:|-------:|-------:|-------:|
| CADUSD | -1.386 | 1.369 | 3.418 | 16.546 | -0.407 | -0.138 |

| 0     |      1 |      2 |     3 |      4 |     5 |      6 |
|:------|-------:|-------:|------:|-------:|------:|-------:|
| USBND | -9.591 | 17.931 | 13.27 | 21.581 | 2.524 | 34.161 |

| 0     |      1 |      2 |     3 |      4 |      5 |      6 |
|:------|-------:|-------:|------:|-------:|-------:|-------:|
| CHBND | -9.591 | 17.931 | 13.27 | 14.253 | -3.006 | 18.736 |

| 0     |      1 |      2 |     3 |      4 |     5 |      6 |
|:------|-------:|-------:|------:|-------:|------:|-------:|
| AUBND | -9.591 | 17.931 | 13.27 | 17.134 | -3.41 | 88.784 |

| 0     |      1 |      2 |     3 |      4 |      5 |      6 |
|:------|-------:|-------:|------:|-------:|-------:|-------:|
| DEBND | -9.591 | 17.931 | 13.27 | 19.062 | -4.249 | 94.968 |

7.5 price
value (κ =0)
3
7.0
value (κ ≠0)
3
6.5
6.0
5.5
5.0
4.5
4.0
6 6 6 6 6 6
1 5 9 3 7 1
8 8 8 9 9 0
1 1 1 1 1 2
Figure 16: Log-price of US stock index together with the smoothed value in model with lin-
ear demand of fundamentalists calculated by Kalman Smoother for parameters in Table 3 and for
model with non-linear demand of fundamentalists calculated by Unscented Kalman Smoother for
parameters in Table 5.
7
price
value (κ =0)
3
6 value (κ ≠0)
3
5
4
3
0 0 0 0 0 0
2 6 0 4 8 2
8 8 9 9 9 0
1 1 1 1 1 2
Figure 17: Log-price of sugar together with the smoothed value in model with linear demand
of fundamentalists calculated by Kalman Smoother for parameters in Table 3 and for model with
non-linear demand of fundamentalists calculated by Unscented Kalman Smoother for parameters in
Table 5.
41

price
0.2
value (κ =0)
3
0.0 value (κ 3≠0)
−0.2
−0.4
−0.6
−0.8
−1.0
6 1 6 1 6 1 6 1 6
7 8 8 9 9 0 0 1 1
9 9 9 9 9 0 0 0 0
1 1 1 1 1 2 2 2 2
Figure 18: Logarithm of JPY/USD exchange rate together with the smoothed value in model with
linear demand of fundamentalists calculated by Kalman Smoother for parameters in Table 3 and for
model with non-linear demand of fundamentalists calculated by Unscented Kalman Smoother for
parameters in Table 5.
price
2.5 value (κ 3=0)
value (κ ≠0)
3
2.0
1.5
1.0
0.5
4 4 4 4 4
3 5 7 9 1
9 9 9 9 0
1 1 1 1 2
Figure 19: Logarithm of yields on US sovereign bonds together with the smoothed value in model
with linear demand of fundamentalists calculated by Kalman Smoother for parameters in Table 3 and
for model with non-linear demand of fundamentalists calculated by Unscented Kalman Smoother
for parameters in Table 5.
42

B EM algorithm
B.1 A description of the algorithm
The goal of EM algorithm is to find the set of parameters θ = {κ,β,σ ,σ ,g} for
N V
which the model (3.8) achieves the maximum likelihood. Since fundamental value v˜
t
is a hidden variable, it is hard to compute the likelihood function of system (3.8) and
it is hard to find its maximum directly, in a general case. On the other hand, we can
rewrite the likelihood of the system as
(cid:90)
L(θ) = P (p |θ) = P (p ,v˜ |θ)dv˜ . (B.1)
1:T 1:T 1:T 1:T
Then we can observe that the log-likelihood can be bounded from below by
(cid:18)(cid:90) (cid:19)
L(θ) = ln P (p ,v˜ |θ)dv˜
1:T 1:T 1:T
(cid:18)(cid:90) (cid:19)
P (p ,v˜ |θ)
1:T 1:T
= ln Q(v˜ ) dv˜ (B.2)
1:T 1:T
Q(v˜ )
1:T
(cid:90) (cid:18) (cid:19)
P (p ,v˜ |θ)
1:T 1:T
≥ Q(v˜ )ln dv˜ =: F (Q,θ),
1:T 1:T
Q(v˜ )
1:T
where Q is any distribution on v˜ . Defining the energy of a global configuration
1:T
(p ,v˜ ) to be −ln(p ,v˜ |θ), the above quantity denoted by F can be rewritten
1:T 1:T 1:T 1:T
as expected energy plus entropy
(cid:90) (cid:90)
F (Q,θ) = Q(v˜ )ln(P (p ,v˜ |θ))dv˜ − Q(v˜ )ln(Q(v˜ ))dv˜ (B.3)
1:T 1:T 1:T 1:T 1:T 1:T 1:T
and it is called the free energy in statistical physics.
The idea of the EM algorithm is to maximize free energy F instead of maximizing
likelihood L. Algorithm reads
1. Choose Q and θ .
0 0
2. For n = {0,1,2,...,N − 1} repeat two-step procedure:
• E-step: Q = argmax F (Q,θ )
n+1 Q n
• M-step: θ = argmax F (Q ,θ)
n+1 θ n+1
43

Simple reasoning shows that the θ obtained by the above algorithm converges to
n
the local maximum of log-likelihood L(θ). Lets rewrite the free energy as
(cid:90) (cid:18) (cid:19)
P (v˜ |p ,θ)
1:T 1:T
F (Q,θ) = Q(v˜ )ln dv˜
1:T 1:T
Q(v˜ )
1:T
(cid:90)
(B.4)
+ Q(v˜ )ln(P (p |θ))dv˜
1:T 1:T 1:T
= −D (Q(v˜ )||P (v˜ |p ,θ)) + L(θ),
KL 1:T 1:T 1:T
where D (Q||P) denotes Kullback–Leibler divergence from distribution P to Q.
KL
From (B.4) we immediately see that for Q(v˜ ) = P (v˜ |p ,θ) we obtain equality
1:T 1:T 1:T
in (B.2). It means that in E-step we get Q = P (v˜ |p ,θ ) and F (Q ,θ ) =
n+1 1:T 1:T n n+1 n
L(θ ). Then in M-step we search for θ such that F (Q ,θ ) ≥ F (Q ,θ )
n n+1 n+1 n+1 n+1 n
and we can write it all together
L(θ ) ≥ F (Q ,θ ) ≥ F (Q ,θ ) = L(θ ). (B.5)
n+1 n+1 n+1 n+1 n n
we see that the θ converges to the local maximum of log-likelihood function.
n
The last equality in (B.5) holds only if Q is exactly the distribution of v˜ con-
n+1 t
ditioned on observed prices and parameters. We compute P (v˜ |p ,θ ) by means
1:t 1:t n
of Bayesian filtering. However, only in the case of linear models we are able to com-
pute it exactly and for non-linear models one has to use as Q an approximation
n+1
of P (v˜ |p ,θ ), which will have non-zero Kullback–Leibler distance from the true
1:T 1:T n
distribution. In the cases when the distance is small we still can hope that EM al-
gorithm will converge to the parameters maximizing likelihood. However, in general
situation we cannot provide any guarantee and very often estimation with EM algo-
rithm for models non-linear in fundamental value will provide results far away from
the ones maximizing likelihood.
Going back to our linear in fundamental value version of our model, we know that
Q = P (v˜ |p ,θ ). Noticing that the second component of free energy in (B.3)
n+1 1:T 1:T n
does not depend on θ, we can simplify EM algorithm as follows:
1. Choose θ .
0
2. For n = {0,1,2,...,N − 1} repeat two-step procedure:
• E-step: compute G(θ,θ ) := E [ln(P (p ,v˜ |θ))]
n P(v˜ |p ,θ ) 1:T 1:T
1:T 1:T n
• M-step: θ = argmax G(θ,θ )
n+1 θ n
44

B.2 Computing E-step
In the E-step we compute the expectation of joint log-probability of (p ,v˜ ) condi-
1:T 1:T
tioned on θ with respect to probability of v˜ conditioned on p and θ . It is given
1:T 1:T n
by formula:
T
1 (cid:88)
2
G(θ,θ ) = − E (p − p − κ(v˜ − p ) − βu ) − T lnσ
n n t t−1 t t−1 t N
2σ2
N
t=1
T−1
1 (cid:88) (B.6)
2
− E (v˜ − v˜ − g) − (T − 1)lnσ − T ln(2π)
n t+1 t V
2σ2
V
t=1
1
(cid:0) (cid:1)
− E v˜2 + v˜2 − 2v˜ E v˜ + g2 − 2g (E v˜ − v˜ ) − lnσ ,
2σ2 n 1 0 0 n 1 n t+1 0 0
0
where all the expectations are taken with respect to distribution P (v˜ |p ,θ ). Note
1:T 1:T n
also that v˜ is a parameter, not hidden variable. To calculate the above expression it is
0
sufficient to know distributions P(v˜ |p ,θ ) and P(v˜ ,v˜ |p ,θ ) for t = 1,...,T −
t 1:T n t t+1 1:T n
1. The process of inferring the distribution of hidden variables given the parameters
and the complete time series of observable variables of the system is called Bayesian
smoothing. To proceed the smoothing one needs to proceed firstly Bayesian filtering
P(v˜ |p ,θ ) and predicting P(v˜ |p ,θ ). Using Markov property of the process
t 1:t n t+1 1:t n
(P(v˜ |v˜ ,p ) = P(v˜ |v˜ ,p )), smoothing reads
t t+1 1:t t t+1 1:T
P(v˜ ,v˜ |p ,θ ) = P(v˜ |v˜ ,p ,θ )P(v˜ |p ,θ )
t t+1 1:T n t t+1 1:t n t+1 1:T n
P(v˜ |v˜ ,θ ) (B.7)
t+1 t n
= P(v˜ |p ,θ ) P(v˜ |p ,θ )
t 1:t n t+1 1:T n
P(v˜ |p ,θ )
t+1 1:t n
and
(cid:90)
P(v˜ |p ,θ ) = P(v˜ ,v˜ |p ,θ )dv˜
t 1:T n t t+1 1:T n t+1
(B.8)
(cid:90)
P(v˜ |v˜ ,θ )
t+1 t n
= P(v˜ |p ,θ ) P(v˜ |p ,θ )dv˜ .
t 1:t n t+1 1:T n t+1
P (v˜ |p ,θ )
t+1 1:t n
Apart from filtering and predicting components on the right sides of both equa-
tions, we have the dynamics of value process P(v˜ |v˜ ,θ ) = N(v˜ ,σ ) and the
t+1 t n t V
smoothing one time step ahead P(v˜ |p ,θ ). Therefore, we compute the smooth-
t+1 1:T n
ing distributions in backward recursions which we initialize by setting P(v˜ |p ,θ )
T 1:T n
equal to the filtered distribution.
To sum up, each iteration n of E-step contains four parts:
1. Filter out distributions P (v˜ |p ,θ ) for t = 1,...,T,
t 1:t n
45

2. Smooth out distributions P (v˜ |p ,θ ) for t = T,...,1,
t 1:T n
3. Smooth out distributions P (v˜ ,v˜ |p ,θ ) for t = T − 1,...,1,
t t+1 1:T n
4. Compute G (θ,θ ).
n
B.3 Kalman filtering and smoothing
In the case of linear dynamic system the computations in E-step of EM algorithm
are called Kalman filter and Kalman smoother. All the distributions obtained in this
procedure (filtering, predicting and smoothing) are Gaussian:
(cid:0) (cid:1)
P (v˜ |p ,θ ) = N v˜t,V t ,
t 1:t n t t
(cid:0) (cid:1)
P (v˜ |p ,θ ) = N v˜t ,V t , (B.9)
t+1 1:t n t+1 t+1
(cid:0) (cid:1)
P (v˜ |p ,θ ) = N v˜T,V T .
t 1:T n t t
The predicted and filtered fundamental values: v˜t , v˜t+1, and their variances:
t+1 t+1
V t , V t+1 at (n + 1)-th iteration of E-step are given by Kalman filter forward recur-
t+1 t+1
sions11
v˜t = v˜t + g(n),
t+1 t
(cid:16) (cid:17)2
V t = V˜t + σ(n) ,
t+1 t V
κ(n)V t
t+1
K = , (B.10)
t+1 (cid:16) (cid:17)2
(κ(n))2 V t + σ(n)
t+1 N
(cid:0) (cid:0) (cid:1) (cid:1)
v˜t+1 = v˜t + K p − p − κ(n) v˜t − p − β(n)u ,
t+1 t+1 t+1 t t−1 t+1 t−1 t
V t+1 = V˜t − κ(n)K V˜t ,
t+1 t+1 t+1 t+1
(cid:16) (cid:17)2
where v˜0 = v˜(n) and V 0 = σ(n) . The smoothed fundamental values v˜T and their
1 0 1 0 t+1
variances V T at (n+1)-th iteration of E-step are given by Kalman smoother backward
t
recursions12
J = V t−1/V t−1,
t−1 t−1 t
(cid:0) (cid:1)
v˜T = v˜t−1 + J v˜T − v˜t−1 , (B.11)
t−1 t−1 t−1 t t−1
(cid:0) (cid:1)
V T = V t−1 + (J )2 V T − V t ,
t−1 t−1 t−1 t t−1
11For esthetic reasons we write shortly v˜t instead of (v˜t )(n). The same holds true for v˜t+1,
t+1 t+1 t+1
V t , V t+1 and K .
t+1 t+1 t+1
12For esthetic reasons we write shortly v˜T instead of (v˜T )(n). The same holds true for V T ,
t+1 t−1 t−1
CT and J .
t−1,t t−1
46

with J = 0. The recursions in Kalman smoothing procedure are often called
T
Rauch–Tung–Striebel recursions. In order to compute E-step we also need the co-
variance of v˜ and v˜ conditioned on p and θ(n) and we denote this covariance by
t−1 t 1:T
CT :
t−1,t
(cid:0) (cid:1)
CT = V t−1J + J CT − V t−1 J , (B.12)
t−2,t−1 t−1 t−2 t−1 t−1,t t−1 t−2
which is initialized as CT = (1 − κK )V T−1. The derivation of Kalman filter and
T−1,T T T−1
smoothing recursions can be found for example in Särkkä (2013). The components
in (B.6) are given by
E v˜ = v˜T, E v˜2 = V T + (v˜T)2 and E v˜ v˜ = CT + v˜Tv˜T . (B.13)
n k k n k k k n k+1 k k−1,k k k+1
B.4 Computing M-step
A set of parameters maximising G(θ,θ ) can be found by solving set of equations
n
∂ G(θ,θ ) = 0. In this way we obtain:
n
∂θ
(cid:20) (cid:21)
κ(n+1)
= A−1b, (B.14)
β(n+1)
where
(cid:20)(cid:80)T (cid:80)T (cid:21)
E [(v˜ − p )2] E [v˜ − p ]u
A = t=1 n t t−1 t=1 n t t−1 t (B.15)
(cid:80)T (cid:80)T
E [v˜ − p ]u u2
t=1 n t t−1 t t=1 t
and
(cid:20)(cid:80)T (cid:21)
E [v˜ − p ](p − p )
b = t=1 n t t−1 t t−1 , (B.16)
(cid:80)T
u (p − p )
t=1 t t t−1
where all conditional expectations are obtained via Kalman smoothing: v˜T and V T
t t
in (B.11). Moreover,
(cid:32) (cid:33)1/2
T
σ(n+1) = 1 (cid:88) E (cid:0) p − p − κ(n+1) (v˜ − p ) − β(n+1)u (cid:1)2 , (B.17)
N T n t t−1 t t−1 t
t=1
T−1
1 (cid:88)
g(n+1) = (E v˜ − E v˜ ), (B.18)
n k+1 n k
T − 1
k=1
(cid:32) (cid:33)1/2
T−1
1 (cid:88)(cid:16) g(n+1)(cid:1)2(cid:17)
σ(n+1) = E v˜2 + E v˜2 − 2E v˜ v˜ − (cid:0) , (B.19)
V T − 1 n k n k+1 n k+1 k
k=1
v˜(n+1) = E v˜ − g(n+1) (B.20)
0 n 1
47

and
(cid:113) (cid:16) (cid:17)2
σ(n+1) = E v˜2 − v˜(n+1) . (B.21)
0 n 1 0
The parameters obtained via EM algorithm are maximizing the predictive likelihood,
which we will monitor:
(cid:34) (cid:35)
T 2
L(θ) = −T ln2π − 1 (cid:88) ln(cid:0) κ2V t−1 + σ2 (cid:1) − (p t − p t−1 − µ t) , (B.22)
(cid:0) (cid:1)
2 2 t N 2 κ2V t−1 + σ2
t=1 t N
(cid:0) (cid:1)
where µ = κ v˜t−1 − p + βu .
t t t−1 t
C Estimation of model 4.1
We write the so-called predictive log-likelihood as
T
(cid:88)
L(θ) = lnP (p |θ) = lnP (p |p ,θ)
1:T t 1:t−1
t=1
(C.1)
(cid:34) (cid:35)
T 2
T 1 (cid:88) (p − pˆ )
t t ˆ
≈ − ln2π − lnS + = L(θ),
t
2 2 S
t
t=1
where we introduce the notation p = {p ,p ,...,p }, pˆ is the next-month price
1:t 1 2 t t
prediction with UKF and S is the variance of that prediction given all price history
t
and set of parameters θ (see formulas (C.4)). Applying a standard optimizer13 we
search for the set of parameters that maximizes predictive log-likelihood, computed
by means of UKF.
C.1 Unscented Kalman Filter
Since model (4.2) has linear dynamics of fundamental value, the prediction step is
the same as in Section B.3. Therefore, the recursions for v˜t , V t are the same as
t+1 t+1
in (B.10). To filter out the fundamental value we form sigma points
V(0) = v˜t ,
t+1 t+1
√ (cid:113)
V(1) = v˜t + 1 + λ V t , (C.2)
t+1 t+1 t+1
√ (cid:113)
V(2) = v˜t − 1 + λ V t ,
t+1 t+1 t+1
13We use minimize from scipy.optimize package in Python using the Broyden-Fletcher-
Goldfarb-Shanno (BFGS) method.
48

where λ = a2 (1 + k)−1, a and k are parameters of Unscented Transform (we choose
a = 1.0 and k = 2.0). We compute the expected price for each sigma point
(cid:16) (cid:17)
(i) (i)
P = p + f V − p + βu , for i = 0,1,2. (C.3)
t+1 t t+1 t t+1
The predicted price pˆ , the variance of price prediction S , and the covariance of
t+1 t+1
the fundamental value and the price C are computed with the following forumlae:
t+1
2
(cid:88)
(m) (i)
pˆ = W P
t+1 i t+1
i=0
2
(cid:88) (cid:16) (cid:17)2
S = W(c) P(i) − pˆ + σ2 (C.4)
t+1 i t+1 t+1 N
i=0
2
(cid:88) (cid:16) (cid:17)(cid:16) (cid:17)
C = W(c) P(i) − pˆ V(i) − v˜t ,
t+1 i t+1 t+1 t+1 t+1
i=0
where weights of the Unscented Transform are given by
(m)
W = λ/(λ + 1)
0
W(c) = λ/(λ + 1) + (1 − a2 + b)
0
(C.5)
(m)
W = 1/[2(λ + 1)], i = 1,2
i
(c)
W = 1/[2(λ + 1)], i = 1,2
i
where b is the parameter of Unscented Transform (we choose b = 0.0). The filter gain
K , the filtered mean and variance of fundamental value, v˜t+1 and V t+1 are
t+1 t+1 t+1
K = S /C ,
t+1 t+1 t+1
v˜t+1 = v˜t + K (p − pˆ ), (C.6)
t+1 t+1 t+1 t+1 t+1
V t+1 = V t − (K )2S .
t+1 t+1 t+1 t+1
Then we approximate the predicting distribution by Gaussian and consequently the
smoothing distributions are approximately Gaussian too. As a consequence, recur-
sions for v˜T , V T , CT and J are the same as in (B.11) and (B.12).
t+1 t−1 t−1,t t−1
49