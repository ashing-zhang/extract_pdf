Perform Self‑Diagnosis Tests On Your Laravel Application
Thispackageallowsyoutorunself‑diagnosistestsonyourLaravelapplication. Itcomeswithmultiple
checks out of the box and allows you to add custom checks yourself.
Here is an example output of the command:
Included checks
• Is the APP_KEY set?
• Are your composer dependencies up to date with the composer.lock file?
• Do you have the correct PHP version installed?
• Do you have the correct PHP extensions installed?
• Can a connection to the database be established?
• Do the storage and bootstrap/cache directories have the correct permissions?
• Does the .env file exist?
• Is the maintenance mode disabled?
• Are the required locales installed on the system?
1

• Are there environment variables that exist in .env.example but not in .env?
• Are there any migrations that need to be run?
• Is the storage directory linked?
• Can Redis be accessed?
Development environment checks
• Is the configuration not cached?
• Are the routes not cached?
• Are there environment variables that exist in .env but not in .env.example?
Production environment checks
• Is the configuration cached?
• Are the routes cached?
• Is the xdebug PHP extension disabled?
• Is APP_DEBUG set to false?
• Are certain servers reachable?
• Are certain supervisor programs running?
Installation
You can install the package via composer:
1 composer require beyondcode/laravel-self-diagnosis
Usage
Just call the artisan command to start the checks:
1 php artisan self-diagnosis
Customization
You can publish the configuration file, that contains all available checks using:
1 php artisan vendor:publish --provider=BeyondCode\\SelfDiagnosis\\
SelfDiagnosisServiceProvider
2

| 1 php artisan vendor:publish --provider=BeyondCode\\SelfDiagnosis\\   |
|:----------------------------------------------------------------------|
| SelfDiagnosisServiceProvider                                          |

This will publish a self-diagnosis.php file in your config folder. This file contains all the
checks that will be performed on your application.
1 <?php
2
3 return [
4
5 /*
6 * A list of environment aliases mapped to the actual environment
configuration.
7 */
8 'environment_aliases' => [
9 'prod' => 'production',
10 'live' => 'production',
11 'local' => 'development',
12 ],
13
14 /*
15 * Common checks that will be performed on all environments.
16 */
17 'checks' => [
18 \BeyondCode\SelfDiagnosis\Checks\AppKeyIsSet::class,
19 \BeyondCode\SelfDiagnosis\Checks\CorrectPhpVersionIsInstalled::
class,
20 \BeyondCode\SelfDiagnosis\Checks\DatabaseCanBeAccessed::class
=> [
21 'default_connection' => true,
22 'connections' => [],
23 ],
24 \BeyondCode\SelfDiagnosis\Checks\
DirectoriesHaveCorrectPermissions::class => [
25 'directories' => [
26 storage_path(),
27 base_path('bootstrap/cache'),
28 ],
29 ],
30 \BeyondCode\SelfDiagnosis\Checks\EnvFileExists::class,
31 \BeyondCode\SelfDiagnosis\Checks\
ExampleEnvironmentVariablesAreSet::class,
32 \BeyondCode\SelfDiagnosis\Checks\LocalesAreInstalled::class =>
[
33 'required_locales' => [
34 'en_US',
35 'en_US.utf8',
36 ],
37 ],
38 \BeyondCode\SelfDiagnosis\Checks\MaintenanceModeNotEnabled::
class,
39 \BeyondCode\SelfDiagnosis\Checks\MigrationsAreUpToDate::class,
40 \BeyondCode\SelfDiagnosis\Checks\PhpExtensionsAreInstalled::
class => [
3

| 1 <?php                                                            |
|:-------------------------------------------------------------------|
| 2                                                                  |
| 3 return [                                                         |
| 4                                                                  |
| 5 /*                                                               |
| 6 * A list of environment aliases mapped to the actual environment |
| configuration.                                                     |
| 7 */                                                               |
| 8 'environment_aliases' => [                                       |
| 9 'prod' => 'production',                                          |
| 10 'live' => 'production',                                         |
| 11 'local' => 'development',                                       |
| 12 ],                                                              |
| 13                                                                 |
| 14 /*                                                              |
| 15 * Common checks that will be performed on all environments.     |
| 16 */                                                              |
| 17 'checks' => [                                                   |
| 18 \BeyondCode\SelfDiagnosis\Checks\AppKeyIsSet::class,            |
| 19 \BeyondCode\SelfDiagnosis\Checks\CorrectPhpVersionIsInstalled:: |
| class,                                                             |
| 20 \BeyondCode\SelfDiagnosis\Checks\DatabaseCanBeAccessed::class   |
| => [                                                               |
| 21 'default_connection' => true,                                   |
| 22 'connections' => [],                                            |
| 23 ],                                                              |
| 24 \BeyondCode\SelfDiagnosis\Checks\                               |
| DirectoriesHaveCorrectPermissions::class => [                      |
| 25 'directories' => [                                              |
| 26 storage_path(),                                                 |
| 27 base_path('bootstrap/cache'),                                   |
| 28 ],                                                              |
| 29 ],                                                              |
| 30 \BeyondCode\SelfDiagnosis\Checks\EnvFileExists::class,          |
| 31 \BeyondCode\SelfDiagnosis\Checks\                               |
| ExampleEnvironmentVariablesAreSet::class,                          |
| 32 \BeyondCode\SelfDiagnosis\Checks\LocalesAreInstalled::class =>  |
| [                                                                  |
| 33 'required_locales' => [                                         |
| 34 'en_US',                                                        |
| 35 'en_US.utf8',                                                   |
| 36 ],                                                              |
| 37 ],                                                              |
| 38 \BeyondCode\SelfDiagnosis\Checks\MaintenanceModeNotEnabled::    |
| class,                                                             |
| 39 \BeyondCode\SelfDiagnosis\Checks\MigrationsAreUpToDate::class,  |
| 40 \BeyondCode\SelfDiagnosis\Checks\PhpExtensionsAreInstalled::    |
| class => [                                                         |

41 'extensions' => [
42 'openssl',
43 'PDO',
44 'mbstring',
45 'tokenizer',
46 'xml',
47 'ctype',
48 'json',
49 ],
50 'include_composer_extensions' => true,
51 ],
52 \BeyondCode\SelfDiagnosis\Checks\StorageDirectoryIsLinked::
class,
53 ],
54
55 /*
56 * Environment specific checks that will only be performed for the
corresponding environment.
57 */
58 'environment_checks' => [
59 'development' => [
60 \BeyondCode\SelfDiagnosis\Checks\
ComposerWithDevDependenciesIsUpToDate::class => [
61 'additional_options' => '--ignore-platform-reqs',
62 ],
63 \BeyondCode\SelfDiagnosis\Checks\ConfigurationIsNotCached::
class,
64 \BeyondCode\SelfDiagnosis\Checks\RoutesAreNotCached::class,
65 ],
66 'production' => [
67 \BeyondCode\SelfDiagnosis\Checks\
ComposerWithoutDevDependenciesIsUpToDate::class => [
68 'additional_options' => '--ignore-platform-reqs',
69 ],
70 \BeyondCode\SelfDiagnosis\Checks\ConfigurationIsCached::
class,
71 \BeyondCode\SelfDiagnosis\Checks\DebugModeIsNotEnabled::
class,
72 \BeyondCode\SelfDiagnosis\Checks\PhpExtensionsAreDisabled::
class => [
73 'extensions' => [
74 'xdebug',
75 ],
76 ],
77 \BeyondCode\SelfDiagnosis\Checks\RedisCanBeAccessed::class
=> [
78 'default_connection' => true,
79 'connections' => [],
80 ],
81 \BeyondCode\SelfDiagnosis\Checks\RoutesAreCached::class,
82 \BeyondCode\SelfDiagnosis\Checks\ServersArePingable::class
4

| 41 'extensions' => [                                                 |
|:---------------------------------------------------------------------|
| 42 'openssl',                                                        |
| 43 'PDO',                                                            |
| 44 'mbstring',                                                       |
| 45 'tokenizer',                                                      |
| 46 'xml',                                                            |
| 47 'ctype',                                                          |
| 48 'json',                                                           |
| 49 ],                                                                |
| 50 'include_composer_extensions' => true,                            |
| 51 ],                                                                |
| 52 \BeyondCode\SelfDiagnosis\Checks\StorageDirectoryIsLinked::       |
| class,                                                               |
| 53 ],                                                                |
| 54                                                                   |
| 55 /*                                                                |
| 56 * Environment specific checks that will only be performed for the |
| corresponding environment.                                           |
| 57 */                                                                |
| 58 'environment_checks' => [                                         |
| 59 'development' => [                                                |
| 60 \BeyondCode\SelfDiagnosis\Checks\                                 |
| ComposerWithDevDependenciesIsUpToDate::class => [                    |
| 61 'additional_options' => '--ignore-platform-reqs',                 |
| 62 ],                                                                |
| 63 \BeyondCode\SelfDiagnosis\Checks\ConfigurationIsNotCached::       |
| class,                                                               |
| 64 \BeyondCode\SelfDiagnosis\Checks\RoutesAreNotCached::class,       |
| 65 ],                                                                |
| 66 'production' => [                                                 |
| 67 \BeyondCode\SelfDiagnosis\Checks\                                 |
| ComposerWithoutDevDependenciesIsUpToDate::class => [                 |
| 68 'additional_options' => '--ignore-platform-reqs',                 |
| 69 ],                                                                |
| 70 \BeyondCode\SelfDiagnosis\Checks\ConfigurationIsCached::          |
| class,                                                               |
| 71 \BeyondCode\SelfDiagnosis\Checks\DebugModeIsNotEnabled::          |
| class,                                                               |
| 72 \BeyondCode\SelfDiagnosis\Checks\PhpExtensionsAreDisabled::       |
| class => [                                                           |
| 73 'extensions' => [                                                 |
| 74 'xdebug',                                                         |
| 75 ],                                                                |
| 76 ],                                                                |
| 77 \BeyondCode\SelfDiagnosis\Checks\RedisCanBeAccessed::class        |
| => [                                                                 |
| 78 'default_connection' => true,                                     |
| 79 'connections' => [],                                              |
| 80 ],                                                                |
| 81 \BeyondCode\SelfDiagnosis\Checks\RoutesAreCached::class,          |
| 82 \BeyondCode\SelfDiagnosis\Checks\ServersArePingable::class        |

=> [
83 'servers' => [
84 'www.google.com',
85 ['host' => 'www.google.com', 'port' => 8080],
86 '8.8.8.8',
87 ['host' => '8.8.8.8', 'port' => 8080, 'timeout' =>
5],
88 ],
89 ],
90 \BeyondCode\SelfDiagnosis\Checks\
SupervisorProgramsAreRunning::class => [
91 'programs' => [
92 'horizon',
93 ],
94 'restarted_within' => 300, // max seconds since last
restart, 0 to disable check
95 ],
96 ],
97 ],
98
99 ];
Available Configuration Options The following options are available for the individual checks:
• BeyondCode\SelfDiagnosis\Checks\ComposerWithDevDependenciesIsUpToDate
– additional_options (string, optional parameters like '--ignore-platform-reqs'):
optional arguments for composer
• BeyondCode\SelfDiagnosis\Checks\ComposerWithoutDevDependenciesIsUpToDate
– additional_options (string, optional parameters like '--ignore-platform-reqs'):
optional arguments for composer
• BeyondCode\SelfDiagnosis\Checks\DatabaseCanBeAccessed
– default_connection (boolean, default: true): if the default connection should be
checked
– connections(array,listofconnectionnameslike['mysql', 'sqlsrv'],default: []):
additional connections to check
• BeyondCode\SelfDiagnosis\Checks\DirectoriesHaveCorrectPermissions
– directories (array, list of directory paths like [storage_path(), base_path('
bootstrap/cache')], default: []): directories to check
5

| => [                                                    |
|:--------------------------------------------------------|
| 83 'servers' => [                                       |
| 84 'www.google.com',                                    |
| 85 ['host' => 'www.google.com', 'port' => 8080],        |
| 86 '8.8.8.8',                                           |
| 87 ['host' => '8.8.8.8', 'port' => 8080, 'timeout' =>   |
| 5],                                                     |
| 88 ],                                                   |
| 89 ],                                                   |
| 90 \BeyondCode\SelfDiagnosis\Checks\                    |
| SupervisorProgramsAreRunning::class => [                |
| 91 'programs' => [                                      |
| 92 'horizon',                                           |
| 93 ],                                                   |
| 94 'restarted_within' => 300, // max seconds since last |
| restart, 0 to disable check                             |
| 95 ],                                                   |
| 96 ],                                                   |
| 97 ],                                                   |
| 98                                                      |
| 99 ];                                                   |

• BeyondCode\SelfDiagnosis\Checks\LocalesAreInstalled
– required_locales (array, list of locales like ['en_US', 'en_US.utf8'], default: []):
locales to check
• BeyondCode\SelfDiagnosis\Checks\PhpExtensionsAreDisabled
– extensions (array, list of extension names like ['xdebug', 'zlib'], default: []): ex‑
tensions to check
• BeyondCode\SelfDiagnosis\Checks\PhpExtensionsAreInstalled
– extensions (array, list of extension names like ['openssl', 'PDO'], default: []): ex‑
tensions to check
– include_composer_extensions (boolean, default: false): if required extensions
defined in composer.json should be checked
• BeyondCode\SelfDiagnosis\Checks\RedisCanBeAccessed
– default_connection (boolean, default: true): if the default connection should be
checked
– connections (array, list of connection names like ['cache_1', 'cache_2'], default:
[]): additional connections to check
• BeyondCode\SelfDiagnosis\Checks\SupervisorProgramsAreRunning
– programs(array,listofprogramslike['horizon', 'another-program'],default:
[]): programs that are required to be running
– restarted_within (integer, max allowed seconds since last restart of programs (0 = dis‑
abled), default: 0): verifies that programs have been restarted recently to grab code up‑
dates
• BeyondCode\SelfDiagnosis\Checks\ServersArePingable
– servers (array, list of servers and parameters like ['google.com', ['host'=> '
google.com', 'port'=> 8080]]): servers to ping
Custom Checks
You can create custom checks, by implementing the BeyondCode\SelfDiagnosis\Checks\
Check interface and adding the class to the config file. Like this:
1 <?php
2
3 use BeyondCode\SelfDiagnosis\Checks\Check;
6

| 1 <?php                                      |
|:---------------------------------------------|
| 2                                            |
| 3 use BeyondCode\SelfDiagnosis\Checks\Check; |

4
5 class MyCustomCheck implements Check
6 {
7 /**
8 * The name of the check.
9 *
10 * @param array $config
11 * @return string
12 */
13 public function name(array $config): string
14 {
15 return 'My custom check.';
16 }
17
18 /**
19 * Perform the actual verification of this check.
20 *
21 * @param array $config
22 * @return bool
23 */
24 public function check(array $config): bool
25 {
26 return true;
27 }
28
29 /**
30 * The error message to display in case the check does not pass.
31 *
32 * @param array $config
33 * @return string
34 */
35 public function message(array $config): string
36 {
37 return 'This is the error message that users see if "check"
returns false.';
38 }
39 }
7

| 4                                                                  |
|:-------------------------------------------------------------------|
| 5 class MyCustomCheck implements Check                             |
| 6 {                                                                |
| 7 /**                                                              |
| 8 * The name of the check.                                         |
| 9 *                                                                |
| 10 * @param array $config                                          |
| 11 * @return string                                                |
| 12 */                                                              |
| 13 public function name(array $config): string                     |
| 14 {                                                               |
| 15 return 'My custom check.';                                      |
| 16 }                                                               |
| 17                                                                 |
| 18 /**                                                             |
| 19 * Perform the actual verification of this check.                |
| 20 *                                                               |
| 21 * @param array $config                                          |
| 22 * @return bool                                                  |
| 23 */                                                              |
| 24 public function check(array $config): bool                      |
| 25 {                                                               |
| 26 return true;                                                    |
| 27 }                                                               |
| 28                                                                 |
| 29 /**                                                             |
| 30 * The error message to display in case the check does not pass. |
| 31 *                                                               |
| 32 * @param array $config                                          |
| 33 * @return string                                                |
| 34 */                                                              |
| 35 public function message(array $config): string                  |
| 36 {                                                               |
| 37 return 'This is the error message that users see if "check"     |
| returns false.';                                                   |
| 38 }                                                               |
| 39 }                                                               |

Example Output
Testing
1 composer test
Changelog
Please see CHANGELOG for more information what has changed recently.
Contributing
Please see CONTRIBUTING for details.
8

Security
If you discover any security related issues, please email marcel@beyondco.de instead of using the
issue tracker.
Credits
• Marcel Pociot
• All Contributors
License
The MIT License (MIT). Please see License File for more information.
9