Image Super‑Resolution Using Very Deep Residual Channel Attention
Networks
This repository is for RCAN introduced in the following paper
Yulun Zhang, Kunpeng Li, Kai Li, Lichen Wang, Bineng Zhong, and Yun Fu, “Image Super‑Resolution
Using Very Deep Residual Channel Attention Networks”, ECCV 2018, [arXiv]
The code is built on EDSR (PyTorch) and tested on Ubuntu 14.04/16.04 environment (Python3.6, Py‑
Torch_0.4.0, CUDA8.0, cuDNN5.1) with Titan X/1080Ti/Xp GPUs. RCAN model has also been merged
into EDSR (PyTorch).
Visual results reproducing the PSNR/SSIM values in the paper are availble at GoogleDrive. For BI
degradation model, scales=2,3,4,8: Results_ECCV2018RCAN_BIX2X3X4X8
Contents
1. Introduction
2. Train
3. Test
4. Results
5. Citation
6. Acknowledgements
Introduction
Convolutional neural network (CNN) depth is of crucial importance for image super‑resolution (SR).
However,weobservethatdeepernetworksforimageSRaremoredifficulttotrain. Thelow‑resolution
inputs and features contain abundant low‑frequency information, which is treated equally across
channels, hence hindering the representational ability of CNNs. To solve these problems, we pro‑
pose the very deep residual channel attention networks (RCAN). Specifically, we propose a residual
in residual (RIR) structure to form very deep network, which consists of several residual groups with
longskipconnections. Eachresidualgroupcontainssomeresidualblockswithshortskipconnections.
Meanwhile, RIR allows abundant low‑frequency information to be bypassed through multiple skip
connections, making the main network focus on learning high‑frequency information. Furthermore,
we propose a channel attention mechanism to adaptively rescale channel‑wise features by consider‑
ing interdependencies among channels. Extensive experiments show that our RCAN achieves better
accuracy and visual improvements against state‑of‑the‑art methods.
1

Channelattention(CA)architecture.
Residualchannelattentionblock(RCAB)architecture.
The architecture of our proposed residual channel attention network (RCAN).
Train
Prepare training data
1. Download DIV2K training data (800 training + 100 validtion images) from DIV2K dataset or
SNU_CVLab.
2. Specify‘–dir_data’basedontheHRandLRimagespath. Inoption.py,‘–ext’issetas‘sep_reset’,
which first convert .png to .npy. If all the training images (.png) are converted to .npy files, then
set ‘–ext sep’ to skip converting files.
For more informaiton, please refer to EDSR(PyTorch).
2

Begin to train
1. (optional)Downloadmodelsforourpaperandplacethemin‘/RCAN_TrainCode/experiment/model’.
Allthemodels(BIX2/3/4/8, BDX3)canbedownloadedfromDropbox, BaiduYun, orGoogleDrive.
2. Cd to ‘RCAN_TrainCode/code’, run the following scripts to train models.
You can use scripts in file ‘TrainRCAN_scripts’ to train models for our paper.
1 # BI, scale 2, 3, 4, 8
2 # RCAN_BIX2_G10R20P48, input=48x48, output=96x96
3 python main.py --model RCAN --save RCAN_BIX2_G10R20P48 --scale 2
--n_resgroups 10 --n_resblocks 20 --n_feats 64 --reset --chop
--save_results --print_model --patch_size 96
4
5 # RCAN_BIX3_G10R20P48, input=48x48, output=144x144
6 python main.py --model RCAN --save RCAN_BIX3_G10R20P48 --scale 3
--n_resgroups 10 --n_resblocks 20 --n_feats 64 --reset --chop
--save_results --print_model --patch_size 144 --pre_train ../
experiment/model/RCAN_BIX2.pt
7
8 # RCAN_BIX4_G10R20P48, input=48x48, output=192x192
9 python main.py --model RCAN --save RCAN_BIX4_G10R20P48 --scale 4
--n_resgroups 10 --n_resblocks 20 --n_feats 64 --reset --chop
--save_results --print_model --patch_size 192 --pre_train ../
experiment/model/RCAN_BIX2.pt
10
11 # RCAN_BIX8_G10R20P48, input=48x48, output=384x384
12 python main.py --model RCAN --save RCAN_BIX8_G10R20P48 --scale 8
--n_resgroups 10 --n_resblocks 20 --n_feats 64 --reset --chop
--save_results --print_model --patch_size 384 --pre_train ../
experiment/model/RCAN_BIX2.pt
13
14 # RCAN_BDX3_G10R20P48, input=48x48, output=144x144
15 # specify '--dir_data' to the path of BD training data
16 python main.py --model RCAN --save RCAN_BIX3_G10R20P48 --scale 3
--n_resgroups 10 --n_resblocks 20 --n_feats 64 --reset --chop
--save_results --print_model --patch_size 144 --pre_train ../
experiment/model/RCAN_BIX2.pt
Test
Quick start
1. Download models for our paper and place them in ‘/RCAN_TestCode/model’.
Allthemodels(BIX2/3/4/8, BDX3)canbedownloadedfromDropbox, BaiduYun, orGoogleDrive.
3

| 1 # BI, scale 2, 3, 4, 8                                            |
|:--------------------------------------------------------------------|
| 2 # RCAN_BIX2_G10R20P48, input=48x48, output=96x96                  |
| 3 python main.py --model RCAN --save RCAN_BIX2_G10R20P48 --scale 2  |
| --n_resgroups 10 --n_resblocks 20 --n_feats 64 --reset --chop       |
| --save_results --print_model --patch_size 96                        |
| 4                                                                   |
| 5 # RCAN_BIX3_G10R20P48, input=48x48, output=144x144                |
| 6 python main.py --model RCAN --save RCAN_BIX3_G10R20P48 --scale 3  |
| --n_resgroups 10 --n_resblocks 20 --n_feats 64 --reset --chop       |
| --save_results --print_model --patch_size 144 --pre_train ../       |
| experiment/model/RCAN_BIX2.pt                                       |
| 7                                                                   |
| 8 # RCAN_BIX4_G10R20P48, input=48x48, output=192x192                |
| 9 python main.py --model RCAN --save RCAN_BIX4_G10R20P48 --scale 4  |
| --n_resgroups 10 --n_resblocks 20 --n_feats 64 --reset --chop       |
| --save_results --print_model --patch_size 192 --pre_train ../       |
| experiment/model/RCAN_BIX2.pt                                       |
| 10                                                                  |
| 11 # RCAN_BIX8_G10R20P48, input=48x48, output=384x384               |
| 12 python main.py --model RCAN --save RCAN_BIX8_G10R20P48 --scale 8 |
| --n_resgroups 10 --n_resblocks 20 --n_feats 64 --reset --chop       |
| --save_results --print_model --patch_size 384 --pre_train ../       |
| experiment/model/RCAN_BIX2.pt                                       |
| 13                                                                  |
| 14 # RCAN_BDX3_G10R20P48, input=48x48, output=144x144               |
| 15 # specify '--dir_data' to the path of BD training data           |
| 16 python main.py --model RCAN --save RCAN_BIX3_G10R20P48 --scale 3 |
| --n_resgroups 10 --n_resblocks 20 --n_feats 64 --reset --chop       |
| --save_results --print_model --patch_size 144 --pre_train ../       |
| experiment/model/RCAN_BIX2.pt                                       |

2. Cd to ‘/RCAN_TestCode/code’, run the following scripts.
You can use scripts in file ‘TestRCAN_scripts’ to produce results for our paper.
1 # No self-ensemble: RCAN
2 # BI degradation model, X2, X3, X4, X8
3 # RCAN_BIX2
4 python main.py --data_test MyImage --scale 2 --model RCAN --
n_resgroups 10 --n_resblocks 20 --n_feats 64 --pre_train ../
model/RCAN_BIX2.pt --test_only --save_results --chop --save '
RCAN' --testpath ../LR/LRBI --testset Set5
5 # RCAN_BIX3
6 python main.py --data_test MyImage --scale 3 --model RCAN --
n_resgroups 10 --n_resblocks 20 --n_feats 64 --pre_train ../
model/RCAN_BIX3.pt --test_only --save_results --chop --save '
RCAN' --testpath ../LR/LRBI --testset Set5
7 # RCAN_BIX4
8 python main.py --data_test MyImage --scale 4 --model RCAN --
n_resgroups 10 --n_resblocks 20 --n_feats 64 --pre_train ../
model/RCAN_BIX4.pt --test_only --save_results --chop --save '
RCAN' --testpath ../LR/LRBI --testset Set5
9 # RCAN_BIX8
10 python main.py --data_test MyImage --scale 8 --model RCAN --
n_resgroups 10 --n_resblocks 20 --n_feats 64 --pre_train ../
model/RCAN_BIX8.pt --test_only --save_results --chop --save '
RCAN' --testpath ../LR/LRBI --testset Set5
11 # BD degradation model, X3
12 # RCAN_BDX3
13 python main.py --data_test MyImage --scale 3 --model RCAN --
n_resgroups 10 --n_resblocks 20 --n_feats 64 --pre_train ../
model/RCAN_BDX3.pt --test_only --save_results --chop --save '
RCAN' --testpath ../LR/LRBD --degradation BD --testset Set5
14 # With self-ensemble: RCAN+
15 # RCANplus_BIX2
16 python main.py --data_test MyImage --scale 2 --model RCAN --
n_resgroups 10 --n_resblocks 20 --n_feats 64 --pre_train ../
model/RCAN_BIX2.pt --test_only --save_results --chop --
self_ensemble --save 'RCANplus' --testpath ../LR/LRBI --testset
Set5
17 # RCANplus_BIX3
18 python main.py --data_test MyImage --scale 3 --model RCAN --
n_resgroups 10 --n_resblocks 20 --n_feats 64 --pre_train ../
model/RCAN_BIX3.pt --test_only --save_results --chop --
self_ensemble --save 'RCANplus' --testpath ../LR/LRBI --testset
Set5
19 # RCANplus_BIX4
20 python main.py --data_test MyImage --scale 4 --model RCAN --
n_resgroups 10 --n_resblocks 20 --n_feats 64 --pre_train ../
model/RCAN_BIX4.pt --test_only --save_results --chop --
self_ensemble --save 'RCANplus' --testpath ../LR/LRBI --testset
Set5
4

| 1 # No self-ensemble: RCAN                                      |
|:----------------------------------------------------------------|
| 2 # BI degradation model, X2, X3, X4, X8                        |
| 3 # RCAN_BIX2                                                   |
| 4 python main.py --data_test MyImage --scale 2 --model RCAN --  |
| n_resgroups 10 --n_resblocks 20 --n_feats 64 --pre_train ../    |
| model/RCAN_BIX2.pt --test_only --save_results --chop --save '   |
| RCAN' --testpath ../LR/LRBI --testset Set5                      |
| 5 # RCAN_BIX3                                                   |
| 6 python main.py --data_test MyImage --scale 3 --model RCAN --  |
| n_resgroups 10 --n_resblocks 20 --n_feats 64 --pre_train ../    |
| model/RCAN_BIX3.pt --test_only --save_results --chop --save '   |
| RCAN' --testpath ../LR/LRBI --testset Set5                      |
| 7 # RCAN_BIX4                                                   |
| 8 python main.py --data_test MyImage --scale 4 --model RCAN --  |
| n_resgroups 10 --n_resblocks 20 --n_feats 64 --pre_train ../    |
| model/RCAN_BIX4.pt --test_only --save_results --chop --save '   |
| RCAN' --testpath ../LR/LRBI --testset Set5                      |
| 9 # RCAN_BIX8                                                   |
| 10 python main.py --data_test MyImage --scale 8 --model RCAN -- |
| n_resgroups 10 --n_resblocks 20 --n_feats 64 --pre_train ../    |
| model/RCAN_BIX8.pt --test_only --save_results --chop --save '   |
| RCAN' --testpath ../LR/LRBI --testset Set5                      |
| 11 # BD degradation model, X3                                   |
| 12 # RCAN_BDX3                                                  |
| 13 python main.py --data_test MyImage --scale 3 --model RCAN -- |
| n_resgroups 10 --n_resblocks 20 --n_feats 64 --pre_train ../    |
| model/RCAN_BDX3.pt --test_only --save_results --chop --save '   |
| RCAN' --testpath ../LR/LRBD --degradation BD --testset Set5     |
| 14 # With self-ensemble: RCAN+                                  |
| 15 # RCANplus_BIX2                                              |
| 16 python main.py --data_test MyImage --scale 2 --model RCAN -- |
| n_resgroups 10 --n_resblocks 20 --n_feats 64 --pre_train ../    |
| model/RCAN_BIX2.pt --test_only --save_results --chop --         |
| self_ensemble --save 'RCANplus' --testpath ../LR/LRBI --testset |
| Set5                                                            |
| 17 # RCANplus_BIX3                                              |
| 18 python main.py --data_test MyImage --scale 3 --model RCAN -- |
| n_resgroups 10 --n_resblocks 20 --n_feats 64 --pre_train ../    |
| model/RCAN_BIX3.pt --test_only --save_results --chop --         |
| self_ensemble --save 'RCANplus' --testpath ../LR/LRBI --testset |
| Set5                                                            |
| 19 # RCANplus_BIX4                                              |
| 20 python main.py --data_test MyImage --scale 4 --model RCAN -- |
| n_resgroups 10 --n_resblocks 20 --n_feats 64 --pre_train ../    |
| model/RCAN_BIX4.pt --test_only --save_results --chop --         |
| self_ensemble --save 'RCANplus' --testpath ../LR/LRBI --testset |
| Set5                                                            |

21 # RCANplus_BIX8
22 python main.py --data_test MyImage --scale 8 --model RCAN --
n_resgroups 10 --n_resblocks 20 --n_feats 64 --pre_train ../
model/RCAN_BIX8.pt --test_only --save_results --chop --
self_ensemble --save 'RCANplus' --testpath ../LR/LRBI --testset
Set5
23 # BD degradation model, X3
24 # RCANplus_BDX3
25 python main.py --data_test MyImage --scale 3 --model RCAN --
n_resgroups 10 --n_resblocks 20 --n_feats 64 --pre_train ../
model/RCAN_BDX3.pt --test_only --save_results --chop --
self_ensemble --save 'RCANplus' --testpath ../LR/LRBD --
degradation BD --testset Set5
The whole test pipeline
1. Prepare test data.
Place the original test sets (e.g., Set5, other test sets are available from GoogleDrive or Baidu)
in ‘OriginalTestData’.
Run ‘Prepare_TestData_HR_LR.m’ in Matlab to generate HR/LR images with different degrada‑
tion models.
2. Conduct image SR.
See Quick start
3. Evaluate the results.
Run ‘Evaluate_PSNR_SSIM.m’ to obtain PSNR/SSIM values for paper.
5

| 21 # RCANplus_BIX8                                              |
|:----------------------------------------------------------------|
| 22 python main.py --data_test MyImage --scale 8 --model RCAN -- |
| n_resgroups 10 --n_resblocks 20 --n_feats 64 --pre_train ../    |
| model/RCAN_BIX8.pt --test_only --save_results --chop --         |
| self_ensemble --save 'RCANplus' --testpath ../LR/LRBI --testset |
| Set5                                                            |
| 23 # BD degradation model, X3                                   |
| 24 # RCANplus_BDX3                                              |
| 25 python main.py --data_test MyImage --scale 3 --model RCAN -- |
| n_resgroups 10 --n_resblocks 20 --n_feats 64 --pre_train ../    |
| model/RCAN_BDX3.pt --test_only --save_results --chop --         |
| self_ensemble --save 'RCANplus' --testpath ../LR/LRBD --        |
| degradation BD --testset Set5                                   |

Results
Quantitative Results
Quantitative results with BI degradation model. Best and second best results are highlighted and
6

underlined
For more results, please refer to our main papar and supplementary file. ### Visual Results
Visual results with Bicubic (BI) degradation (4×) on “img 074” from Urban100
7

8

Visual comparison for 4× SR with BI model
Visual comparison for 8× SR with BI model
9

Visual comparison for 3× SR with BD model
10

Visual comparison for 4× SR with BI model on Set14 and B100 datasets. The best results are high‑
lighted. SRResNet,SRResNetVGG22,SRGANMSE,SR‑GANVGG22,andSRGANVGG54areproposedin
[CVPR2017SRGAN], ENet E and ENet PAT are proposed in [ICCV2017EnhanceNet]. These comparisons
mainly show the effectiveness of our proposed RCAN against GAN based methods
Citation
If you find the code helpful in your resarch or work, please cite the following papers.
1 @InProceedings{Lim_2017_CVPR_Workshops,
2 author = {Lim, Bee and Son, Sanghyun and Kim, Heewon and Nah,
Seungjun and Lee, Kyoung Mu},
11

| 1 @InProceedings{Lim_2017_CVPR_Workshops,                       |
|:----------------------------------------------------------------|
| 2 author = {Lim, Bee and Son, Sanghyun and Kim, Heewon and Nah, |
| Seungjun and Lee, Kyoung Mu},                                   |

3 title = {Enhanced Deep Residual Networks for Single Image Super-
Resolution},
4 booktitle = {The IEEE Conference on Computer Vision and Pattern
Recognition (CVPR) Workshops},
5 month = {July},
6 year = {2017}
7 }
8
9 @inproceedings{zhang2018rcan,
10 title={Image Super-Resolution Using Very Deep Residual Channel
Attention Networks},
11 author={Zhang, Yulun and Li, Kunpeng and Li, Kai and Wang, Lichen
and Zhong, Bineng and Fu, Yun},
12 booktitle={ECCV},
13 year={2018}
14 }
Acknowledgements
This code is built on EDSR (PyTorch). We thank the authors for sharing their codes of EDSR Torch
version and PyTorch version.
12

| 3 title = {Enhanced Deep Residual Networks for Single Image Super-   |
|:---------------------------------------------------------------------|
| Resolution},                                                         |
| 4 booktitle = {The IEEE Conference on Computer Vision and Pattern    |
| Recognition (CVPR) Workshops},                                       |
| 5 month = {July},                                                    |
| 6 year = {2017}                                                      |
| 7 }                                                                  |
| 8                                                                    |
| 9 @inproceedings{zhang2018rcan,                                      |
| 10 title={Image Super-Resolution Using Very Deep Residual Channel    |
| Attention Networks},                                                 |
| 11 author={Zhang, Yulun and Li, Kunpeng and Li, Kai and Wang, Lichen |
| and Zhong, Bineng and Fu, Yun},                                      |
| 12 booktitle={ECCV},                                                 |
| 13 year={2018}                                                       |
| 14 }                                                                 |